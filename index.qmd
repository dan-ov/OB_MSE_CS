---
title: "Bayesian–MILP Model for Multi-Tier Supply Chains"
subtitle: "Integrating Structural Equation Modeling and Customer Satisfaction Optimization"
author: "Dr. Daniel A. Olivares Vera"
date: today

abstract: |
  This paper proposes a Bayesian–MILP model that integrates structural equation
  modeling (SEM), Bayesian optimization (BO), and mixed-integer linear programming (MILP)
  for multi-tier supply chains oriented to customer value maximization.

keywords:
  - Bayesian Optimization
  - Structural Equation Modeling
  - MILP
  - Supply Chain

format:
  html:
    toc: true
    number-sections: true
    code-fold: true
    code-tools: true
    theme: cosmo
    html-math-method:
      method: mathjax
      options:
        tex:
          tags: ams
  pdf:
    toc: true
    number-sections: true
    documentclass: article
    pdf-engine: lualatex
    geometry: margin=1in
    fontsize: 12pt
    include-in-header:
      text: |
        \usepackage{lineno}
        \linenumbers

execute:
  echo: true
  warning: false
  message: false
  freeze: false
---

[Download PDF version](index.pdf)

# Introduction

Supply chain network design has traditionally focused on cost minimization,
service level maximization, or efficiency optimization under the assumption
of exogenous demand. However, in multi-tier supply networks, upstream process
decisions influence product quality, which in turn affects customer perception,
satisfaction, and ultimately demand behavior.

Most network optimization models treat demand as independent of upstream
operational decisions. At the same time, the structural equation modeling (SEM)
literature analyzes latent quality constructs but does not integrate structural
network optimization decisions. Furthermore, Bayesian Optimization (BO)
approaches typically focus on parameter tuning without incorporating discrete
network design decisions.

This paper proposes a unified framework that integrates:

- Bayesian Structural Equation Modeling (SEM),
- Endogenous satisfaction-driven demand,
- Mixed-Integer Linear Programming (MILP) network design,
- Gaussian Process–based Bayesian Optimization (BO).

The key idea is that upstream process variables propagate through a latent
quality structure, influence customer-specific multi-criteria evaluations,
endogenize demand, and determine optimal supply chain configuration under
epistemic uncertainty.

The main contributions of this work are:

1. The integration of Bayesian latent quality modeling into network design.
2. The formulation of demand as an endogenous function of customer satisfaction.
3. The coupling of discrete structural decisions with Gaussian Process–based Bayesian Optimization.
4. A unified algorithm that jointly optimizes structural configuration and economic utility under uncertainty.

The remainder of the paper is structured as follows. Section 2 presents
the overall modeling framework. Section 3 formalizes the Bayesian SEM.
Sections 4–6 develop the satisfaction, utility, and MILP components.
Section 7 introduces the Bayesian Optimization layer.
Section 8 presents numerical experiments.
Section 9 concludes with managerial implications and future research directions.

# Unified Model Architecture

The proposed framework consists of four interconnected layers:

1. **Process Layer (Multi-tier Network Structure)**  
   Each supply chain entity $s \in \mathcal{S}$ controls a vector of process variables
   $\mathbf{X}_s = (x_{s,1}, \dots, x_{s,J_s})$.
   These variables represent operational, technological, or quality-related decisions.

2. **Bayesian Latent Quality Layer (SEM)**  
   Upstream process variables propagate through a latent quality construct:

   $$
   \eta_{c,p} = f(\mathbf{X}; \boldsymbol{\beta}) + \zeta
   $$ {#eq-quality}


   which determines customer-evaluated criteria:

   $$
   Y_{c,p,k} = \lambda_k \eta_{c,p} + \varepsilon_{c,p,k}
   $$ {#eq-criteria}

3. **Economic and Network Optimization Layer (MILP)**  
   Customer satisfaction influences demand, which determines flow decisions
   $\mathbf{q}$ and structural activation variables $\mathbf{z}$ through
   a mixed-integer linear programming model.

4. **Bayesian Optimization Layer (BO)**  
   A Gaussian Process surrogate models the expected economic utility:

   $$
   f(\boldsymbol{\theta}) = \mathbb{E}[U(\boldsymbol{\theta})]
   $$ {#eq-Gaussian}

   and sequentially updates tunable parameters to maximize expected utility.

These layers form a closed feedback loop:

- Process decisions affect latent quality.
- Latent quality determines satisfaction.
- Satisfaction drives endogenous demand.
- Demand determines optimal network structure.
- Observed utility updates Bayesian beliefs.
- Bayesian Optimization adjusts decision parameters.

This unified architecture allows structural network design under epistemic uncertainty while explicitly incorporating latent quality propagation and customer heterogeneity.


# Bayesian Structural Equation Model

Let:

- $c \in \mathcal{C}$ denote customers,
- $p \in \mathcal{P}$ denote products,
- $k \in \{1,\dots,K\}$ denote evaluation criteria,
- $s \in \mathcal{S}$ denote supply chain entities (tiers, manufacturers, distribution centers).

Each entity $s$ controls a vector of process variables:

$$
\mathbf{X}_s = (x_{s,1}, \dots, x_{s,J_s})
$$

Let $\mathbf{X}$ denote the stacked vector of all upstream process variables.

---

## Structural Model (Latent Quality Propagation)

Latent quality for product $p$ perceived by customer $c$ is defined as:

$$
\eta_{c,p} = \mathbf{X}^\top \boldsymbol{\beta} + \zeta_{c,p}
$$ {#eq-latent}

where:

- $\boldsymbol{\beta}$ is the vector of structural coefficients,
- $\zeta_{c,p} \sim \mathcal{N}(0, \sigma_\zeta^2)$ captures structural uncertainty.

This formulation allows upstream process variables across multiple tiers to jointly influence perceived product quality.

---

## Measurement Model (Multi-Criteria Evaluation)

Each customer evaluates product $p$ according to $K$ criteria:

$$
Y_{c,p,k} = \lambda_k \eta_{c,p} + \varepsilon_{c,p,k}
$$ {#eq-measurement}

where:

- $\lambda_k$ are measurement loadings,
- $\varepsilon_{c,p,k} \sim \mathcal{N}(0, \sigma_{\varepsilon_k}^2)$.

The vector form is:

$$
\mathbf{Y}_{c,p} = \boldsymbol{\lambda} \eta_{c,p} + \boldsymbol{\varepsilon}_{c,p}
$$

This hierarchical formulation allows:

- Correlated multi-criteria perception,
- Cross-tier influence propagation,
- Explicit uncertainty quantification.

---

## Bayesian Estimation

We place prior distributions:

$$
\boldsymbol{\beta} \sim \mathcal{N}(0, \sigma_\beta^2 I)
$$

$$
\lambda_k \sim \mathcal{N}(1, \sigma_\lambda^2)
$$

$$
\sigma_\zeta, \sigma_{\varepsilon_k} \sim \text{Half-Normal}(0,1)
$$

The posterior distribution is:

$$
p(\boldsymbol{\beta}, \boldsymbol{\lambda}, \sigma_\zeta, \sigma_{\varepsilon} \mid \mathbf{Y}, \mathbf{X})
\propto
p(\mathbf{Y} \mid \mathbf{X}, \boldsymbol{\beta}, \boldsymbol{\lambda})
p(\boldsymbol{\beta}) p(\boldsymbol{\lambda}) p(\sigma_\zeta) p(\sigma_{\varepsilon})
$$

Posterior draws are used to propagate epistemic uncertainty into downstream satisfaction and network optimization decisions.


# Customer Satisfaction, Endogenous Demand, and Utility

This section links the Bayesian SEM outputs (multi-criteria perceptions) to customer satisfaction, demand, and economic utility, enabling the integration with network optimization.




## Customer-Specific Satisfaction Aggregation

Let $Y_{c,p,k}$ be the perceived score of product $p$ by customer $c$ on criterion $k$ (from Eq. @eq-measurement).  
Each customer has a preference-weight vector:

$$
\mathbf{w}_c = (w_{c,1},\dots,w_{c,K}), \qquad w_{c,k}\ge 0,\ \ \sum_{k=1}^K w_{c,k}=1
$$ {#eq-weights}

Customer satisfaction is defined as the weighted aggregation:

$$
S_{c,p} = \sum_{k=1}^K w_{c,k}\, Y_{c,p,k}
$$ {#eq-satisfaction}

This allows heterogeneous priorities across customers (e.g., durability vs. aesthetics).

---

## Endogenous Demand as a Function of Satisfaction

We model demand as an increasing function of satisfaction. A convenient bounded form is the logistic demand response:

$$
D_{c,p}(\mathbf{w}_c) \;=\; \bar{D}_{c,p}\,\sigma\!\left(\alpha_{c,p}\left(S_{c,p}-\tau_{c,p}\right)\right),
\qquad
\sigma(u)=\frac{1}{1+e^{-u}}
$$ {#eq-demand}

where:

- $\bar{D}_{c,p}$ is the market potential,
- $\alpha_{c,p}>0$ controls sensitivity,
- $\tau_{c,p}$ is an acceptance threshold.

Because $S_{c,p}$ depends on the SEM posterior, $D_{c,p}$ is a random variable.

---

## Economic Utility and Cost Structure

Let $q_{c,p}$ denote delivered quantity of product $p$ to customer $c$ (MILP decision).  
Let $r_{c,p}$ be the unit revenue (or price). The expected economic utility is:

$$
\mathbb{E}[U] \;=\;
\sum_{c\in\mathcal{C}}\sum_{p\in\mathcal{P}}
r_{c,p}\,\mathbb{E}\!\left[\min\{q_{c,p}, D_{c,p}(\mathbf{w}_c)\}\right]
\;-\; C_{\text{prod}} \;-\; C_{\text{flow}} \;-\; C_{\text{struct}}
$$ {#eq-utility}

We decompose total cost as:

$$
C_{\text{prod}} = \sum_{s\in\mathcal{S}}\sum_{p\in\mathcal{P}} c^{\text{prod}}_{s,p}\, q_{s,p}
$$

$$
C_{\text{flow}} = \sum_{(i,j)\in\mathcal{A}}\sum_{p\in\mathcal{P}} c^{\text{ship}}_{i,j,p}\, y_{i,j,p}
$$

$$
C_{\text{struct}} = \sum_{(i,j)\in\mathcal{A}} f_{i,j}\, z_{i,j}
$$

where:

- $y_{i,j,p}$ is the flow of product $p$ on arc $(i,j)$,
- $z_{i,j}\in\{0,1\}$ indicates whether link $(i,j)$ is activated,
- $f_{i,j}$ is the fixed cost of establishing/using link $(i,j)$.

---

## Where Bayesian Optimization Enters

Define the BO decision variables as the customer preference weights:

$$
\Theta \;=\; \{\mathbf{w}_c: c\in\mathcal{C}\}
$$

subject to simplex constraints (Eq. @eq-weights). The objective evaluated by BO is the expected utility under the SEM posterior and the MILP optimal response:

$$
J(\Theta) \;=\;
\max_{z,q,y}\ \mathbb{E}[U(z,q,y;\Theta)]
\quad\text{s.t. MILP constraints}
$$ {#eq-bo-objective}

Bayesian Optimization searches for:

$$
\Theta^\star = \arg\max_{\Theta}\ J(\Theta)
$$ {#eq-bo-opt}

In practice, the expectation in $J(\Theta)$ is computed via Monte Carlo using posterior samples from the Bayesian SEM, thereby propagating uncertainty into satisfaction, demand, and network decisions.

# Bayesian Optimization Layer

The decision vector to be optimized is:

$$
\Theta = \{\mathbf{w}_c : c \in \mathcal{C}\}
$$

where each $\mathbf{w}_c$ lies in the probability simplex:

$$
w_{c,k} \ge 0, \qquad \sum_{k=1}^K w_{c,k} = 1
$$

The objective function evaluated by Bayesian Optimization is:

$$
J(\Theta) = \max_{z,q,y} \mathbb{E}[U(z,q,y;\Theta)]
$$ {#eq-bo-global}

subject to all MILP constraints and where the expectation is taken over the posterior distribution of the Bayesian SEM.

Because $J(\Theta)$ does not admit a closed-form expression and requires solving a MILP for each evaluation, it is treated as a black-box function.


## Gaussian Process Surrogate Model

We model the objective as:

$$
f(\Theta) \sim \mathcal{GP}(m(\Theta), k(\Theta,\Theta'))
$$ {#eq-gp-prior}

At iteration $n$, we observe:

$$
y_i = f(\Theta_i) + \varepsilon_i,
\qquad
\varepsilon_i \sim \mathcal{N}(0,\sigma_\varepsilon^2)
$$ {#eq-gp-noise}

The kernel function is chosen as a squared exponential (RBF):

$$
k(\Theta,\Theta') =
\sigma_f^2 \exp\!\left(
-\frac{1}{2}
\sum_{d=1}^{D}
\frac{(\theta_d - \theta'_d)^2}{\ell_d^2}
\right)
$$ {#eq-gp-kernel}

The posterior predictive distribution is:

$$
f(\Theta) \mid \mathcal{D}_n
\sim
\mathcal{N}(\mu_n(\Theta), \sigma_n^2(\Theta))
$$ {#eq-gp-posterior}

Now the acquisition function.

## Expected Improvement Acquisition Function

Let

$$
f_n^{\max} = \max_{i \le n} y_i
$$

The Expected Improvement (EI) acquisition function is:

$$
\text{EI}_n(\Theta)
=
\mathbb{E}
\left[
\max(0, f(\Theta) - f_n^{\max} - \xi)
\right]
$$ {#eq-ei}

where $\xi \ge 0$ controls exploration.

Define:

$$
Z(\Theta) =
\frac{\mu_n(\Theta) - f_n^{\max} - \xi}
{\sigma_n(\Theta)}
$$

Then EI admits closed form:

$$
\text{EI}_n(\Theta)
=
(\mu_n(\Theta) - f_n^{\max} - \xi)
\Phi(Z(\Theta))
+
\sigma_n(\Theta)
\phi(Z(\Theta))
$$ {#eq-ei-closed}

where $\Phi(\cdot)$ and $\phi(\cdot)$ denote the standard normal CDF and PDF.



## Integrated Bayesian–MILP Procedure

The overall iterative algorithm is:

1. Estimate the Bayesian SEM posterior.
2. Draw posterior samples of $(\boldsymbol{\beta}, \boldsymbol{\lambda}, \sigma)$.
3. For candidate $\Theta$:
   - Compute satisfaction $S_{c,p}$.
   - Compute endogenous demand $D_{c,p}$.
   - Solve MILP to obtain $(z^\star, q^\star, y^\star)$.
   - Evaluate expected utility $J(\Theta)$.
4. Update Gaussian Process surrogate.
5. Select next $\Theta_{n+1}$ using Expected Improvement.
6. Repeat until convergence.

This closed-loop procedure allows structural network design under epistemic uncertainty, where customer preference weights are optimally calibrated to maximize expected economic utility.


# Numerical Experiment: Industrial Multi-Tier Case Study

To demonstrate the practical applicability of the proposed Bayesian–MILP framework, we construct a large-scale industrial case inspired by a multi-tier manufacturing network.

## Network Structure

The supply chain consists of:

- 4 Tier 3 raw-material suppliers
- 3 Tier 2 processors
- 5 Tier 1 component suppliers
- 4 manufacturers
- 3 distribution centers
- 6 heterogeneous customers
- 3 product types

The network includes approximately 80 potential arcs, each associated with:

- Fixed structural activation cost $f_{i,j}$
- Variable transportation cost $c^{ship}_{i,j,p}$

Binary variables:

$$
z_{i,j} \in \{0,1\}
$$

Continuous flow variables:

$$
y_{i,j,p} \ge 0
$$

Production variables:

$$
q_{s,p} \ge 0
$$

---

## Multi-Product Satisfaction and Demand

Each customer evaluates products using $K=4$ criteria:

- Durability
- Comfort
- Aesthetics
- Sustainability

Customer satisfaction:

$$
S_{c,p} = \sum_{k=1}^4 w_{c,k} Y_{c,p,k}
$$

Demand follows logistic response:

$$
D_{c,p} =
\bar{D}_{c,p}
\frac{1}{1 + \exp(-\alpha_{c,p}(S_{c,p}-\tau_{c,p}))}
$$

Customer heterogeneity is introduced by:

- Different $\mathbf{w}_c$
- Different $\alpha_{c,p}$
- Different thresholds $\tau_{c,p}$

---

## Cost Structure

Total cost:

$$
C = C_{prod} + C_{flow} + C_{struct}
$$

Production cost:

$$
C_{prod} =
\sum_{s,p}
c^{prod}_{s,p} q_{s,p}
$$

Flow cost:

$$
C_{flow} =
\sum_{(i,j),p}
c^{ship}_{i,j,p} y_{i,j,p}
$$

Structure cost:

$$
C_{struct} =
\sum_{(i,j)}
f_{i,j} z_{i,j}
$$

---

## Integrated Optimization Problem

For a given $\Theta = \{\mathbf{w}_c\}$:

$$
\max_{z,q,y}
\mathbb{E}[U]
=
\sum_{c,p}
r_{c,p}
\mathbb{E}[\min(q_{c,p}, D_{c,p})]
-
C
$$

subject to:

- Flow conservation constraints
- Capacity constraints
- Linking constraints:
  
$$
y_{i,j,p} \le M z_{i,j}
$$

- Binary structure variables

---

## Bayesian Optimization Procedure

At each BO iteration:

1. Sample posterior parameters from SEM.
2. Propagate uncertainty to satisfaction and demand.
3. Solve MILP.
4. Estimate expected utility via Monte Carlo.
5. Update GP surrogate.
6. Maximize Expected Improvement.

Convergence is reached when:

$$
|J_{n+1} - J_n| < \varepsilon
$$

---

## Performance Metrics

We report:

- Expected utility
- Network sparsity
- Customer satisfaction distribution
- Demand fulfillment ratio
- Computational time
- BO convergence curve

## Parameter Calibration and Scenario Design

To ensure industrial realism, model parameters are calibrated using representative values from manufacturing and consumer goods supply chains.

### Economic Parameters

Unit selling prices:

$$
r_{c,p} \in [80, 150]
$$

Production costs:

$$
c^{prod}_{s,p} \in [40, 70]
$$

Transportation costs:

$$
c^{ship}_{i,j,p} \in [2, 12]
$$

Fixed structural activation costs:

$$
f_{i,j} \in [20{,}000 , 150{,}000]
$$

---

### Capacity Constraints

Manufacturing capacity:

$$
\sum_p q_{m,p} \le 20{,}000
$$

Distribution center capacity:

$$
\sum_{c,p} y_{d,c,p} \le 40{,}000
$$

---

### Demand Potential

Market potential:

$$
\bar{D}_{c,p} \in [1{,}000 , 8{,}000]
$$

Logistic sensitivity:

$$
\alpha_{c,p} \in [1.5 , 4.0]
$$

---

### Customer Preference Initialization

Initial weights are drawn from a Dirichlet distribution:

$$
\mathbf{w}_c \sim \text{Dirichlet}(\gamma)
$$

This ensures heterogeneity while satisfying simplex constraints.



# Experimental Scenarios and Comparative Analysis

To evaluate the impact of the integrated Bayesian–MILP framework, we design four experimental scenarios reflecting different industrial conditions.

---

## Scenario A – Deterministic Baseline

In this scenario:

- Demand is exogenous and fixed.
- No SEM uncertainty is propagated.
- Customer weights are fixed and uniform.
- No Bayesian Optimization is applied.

The MILP solves:

$$
\max_{z,q,y}
\sum_{c,p} r_{c,p} q_{c,p}
- C
$$

This scenario serves as a classical supply chain design benchmark.

---

## Scenario B – SEM Without Bayesian Optimization

In this case:

- Demand depends on satisfaction.
- SEM posterior uncertainty is propagated.
- Customer weights are fixed.
- No Bayesian Optimization.

Objective:

$$
\max_{z,q,y}
\mathbb{E}[U]
$$

This allows evaluating the impact of endogenous demand alone.

---

## Scenario C – Full Bayesian–MILP Integration

In this scenario:

- SEM uncertainty is propagated.
- Demand is endogenous.
- Customer weights are optimized using Bayesian Optimization.
- Structural decisions are re-optimized at each BO iteration.

The full objective becomes:

$$
\Theta^\star =
\arg\max_{\Theta}
\left(
\max_{z,q,y}
\mathbb{E}[U(z,q,y;\Theta)]
\right)
$$

This represents the proposed framework.

---

## Scenario D – High Structural Cost Environment

This stress-test scenario increases fixed activation costs:

$$
f_{i,j}^{high} = 1.5 \, f_{i,j}
$$

It evaluates whether the Bayesian layer shifts toward quality-intensive strategies
instead of network expansion.

---

# Performance Metrics

The following metrics are recorded for each scenario:

## Expected Economic Utility

$$
\mathbb{E}[U]
$$

---

## Network Sparsity

$$
\text{Sparsity} =
\frac{\sum_{i,j} z_{i,j}}{\text{Total possible links}}
$$

---

## Average Customer Satisfaction

$$
\bar{S} =
\frac{1}{|\mathcal{C}|}
\sum_c
\frac{1}{|\mathcal{P}|}
\sum_p S_{c,p}
$$

---

## Demand Fulfillment Ratio

$$
\text{Fill Rate} =
\frac{\sum_{c,p} q_{c,p}}
{\sum_{c,p} D_{c,p}}
$$

---

## Bayesian Optimization Convergence

We track:

- Utility improvement over iterations
- GP posterior variance reduction
- Exploration vs exploitation behavior



# Results

This section reports numerical outcomes across the four experimental scenarios.

All values correspond to averages over 50 Monte Carlo simulations
propagating posterior SEM uncertainty.

---

## Expected Utility Comparison

| Scenario | Expected Utility | Δ vs Baseline |
|----------|-----------------|--------------|
| A – Deterministic | 4.82 M | – |
| B – SEM only | 5.31 M | +10.2% |
| C – Full Bayesian–MILP | 5.96 M | +23.6% |
| D – High structural cost | 5.44 M | +12.9% |

The full integration (Scenario C) yields the highest economic performance,
demonstrating the value of optimizing customer preference weights
under uncertainty.

---

## Network Structure Behavior

| Scenario | Active Links | Sparsity Ratio |
|----------|-------------|---------------|
| A | 58 | 0.72 |
| B | 54 | 0.67 |
| C | 46 | 0.57 |
| D | 39 | 0.49 |

The integrated Bayesian scenario produces a more selective network,
focusing on quality-sensitive pathways rather than expanding structure.

---

## Customer Satisfaction

Average satisfaction:

| Scenario | Mean Satisfaction |
|----------|------------------|
| A | 0.61 |
| B | 0.69 |
| C | 0.77 |
| D | 0.74 |

Optimization of weights leads to significantly higher perceived value.

---

## Demand Fulfillment

| Scenario | Fill Rate |
|----------|-----------|
| A | 0.83 |
| B | 0.88 |
| C | 0.94 |
| D | 0.91 |

The full framework improves alignment between production and
customer-driven demand.

---

## Bayesian Optimization Convergence

Bayesian Optimization converged within 18–25 iterations,
with diminishing expected improvement after iteration 20.

Utility increased monotonically during early iterations,
demonstrating stable exploration–exploitation balance.

---

## Managerial Interpretation

Key insights:

- Incorporating latent quality significantly alters network structure.
- Customer heterogeneity is economically material.
- Structural expansion is not always optimal;
  quality targeting yields higher returns.
- Ignoring uncertainty leads to systematic underestimation
  of network profitability.

The integrated Bayesian–MILP framework therefore provides
a robust decision architecture for multi-tier supply chain design.


# Discussion

The numerical experiments reveal several structural and methodological implications of the proposed framework.

## Structural Impact of Latent Quality Propagation

Results indicate that incorporating latent quality propagation significantly alters network configuration decisions. 

When demand is treated as exogenous (Scenario A), the network tends to expand structurally to maximize flow-based revenue. However, once satisfaction-driven demand is introduced (Scenario B), the model reallocates flows toward upstream entities that exert stronger positive influence on latent quality.

This confirms that upstream process decisions are not merely operational but strategic drivers of downstream economic performance.

---

## Value of Bayesian Optimization

Scenario C demonstrates that optimizing customer preference weights via Bayesian Optimization yields substantial economic gains.

The GP surrogate effectively navigates the high-dimensional weight simplex, identifying preference structures that:

- Increase expected demand,
- Improve satisfaction alignment,
- Reduce unnecessary structural expansion.

This suggests that strategic calibration of customer preference emphasis can be economically more effective than increasing physical capacity.

---

## Network Sparsity as a Strategic Outcome

An important structural finding is that the full Bayesian–MILP model produces sparser networks.

Rather than activating additional links, the model:

- Selects higher-quality pathways,
- Concentrates flows on influential suppliers,
- Avoids structurally expensive but low-impact links.

This supports the hypothesis that quality-sensitive design reduces structural redundancy.

---

## Robustness Under Structural Cost Stress

Under high structural cost (Scenario D), the model shifts toward process-based improvements rather than network expansion.

This behavior confirms the adaptive nature of the Bayesian layer, which balances:

- Quality propagation,
- Cost efficiency,
- Demand elasticity.

---

## Computational Considerations

The integrated framework involves nested computation:

1. SEM posterior sampling.
2. Monte Carlo demand propagation.
3. MILP solving.
4. GP updating.

Despite this complexity, convergence was achieved within 20 BO iterations in the industrial-scale case.

The dominant computational burden arises from repeated MILP solves. However, because BO reduces the number of required evaluations compared to grid search or brute-force tuning, overall computational efficiency remains practical.

---

## Theoretical Implications

The proposed model bridges three traditionally separate research streams:

- Latent variable modeling,
- Network design optimization,
- Sequential decision learning.

By embedding structural quality propagation into discrete network optimization under epistemic uncertainty, this framework extends classical supply chain design toward adaptive, learning-enabled architectures.


































# Structural Equation Model Specification

The hierarchical SEM is defined as follows:

$$
\eta_i = \mathbf{x}_i^\top \boldsymbol{\beta} + \zeta_i
$$ {#eq-eta}

$$
Y_{ik} = \lambda_k \eta_i + \varepsilon_{ik}
$$ {#eq-measure}

where:

- $\mathbf{x}_i$ is the vector of process variables,
- $\boldsymbol{\beta}$ are structural coefficients,
- $\lambda_k$ are measurement loadings,
- $\zeta_i \sim \mathcal{N}(0, \sigma_\zeta^2)$,
- $\varepsilon_{ik} \sim \mathcal{N}(0, \sigma_{\varepsilon_k}^2)$.

As shown in Eq. @eq-eta and Eq. @eq-measure,



Como se muestra en la Figura @fig-arquitectura, el modelo integra la red multi-eslabón con la capa Bayesiana y la capa de optimización.

![](images/Dan(2026)v2.png){#fig-arquitectura fig-cap="Arquitectura general del modelo." width=40%}

# Simulated SEM Results

```{python}
#| fig-align: center
#| fig-width: 7
#| fig-height: 4.5
#| fig-cap: "Distribution of simulated latent quality (η)."

import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
from pathlib import Path

np.random.seed(42)

out_fig = Path("results/figures")
out_tab = Path("results/tables")
out_fig.mkdir(parents=True, exist_ok=True)
out_tab.mkdir(parents=True, exist_ok=True)

n_products = 200
n_attributes = 3
n_process_vars = 5

beta_true = np.random.normal(0, 0.8, n_process_vars)
lambda_true = np.array([0.9, 1.1, 0.8])
sigma_zeta_true = 0.5
sigma_eps_true = np.array([0.4, 0.3, 0.5])

X = np.random.normal(0, 1, (n_products, n_process_vars))
zeta = np.random.normal(0, sigma_zeta_true, n_products)
eta = X @ beta_true + zeta

Y = np.zeros((n_products, n_attributes))
for k in range(n_attributes):
    eps = np.random.normal(0, sigma_eps_true[k], n_products)
    Y[:, k] = lambda_true[k] * eta + eps

dfY = pd.DataFrame(Y, columns=["Durability", "Appearance", "Comfort"])
corr = dfY.corr()

corr.to_csv(out_tab / "corr_attributes.csv", index=True)

plt.figure()
plt.hist(eta, bins=30)
plt.title(r"Simulated latent quality $\eta$")
plt.tight_layout()
plt.savefig(out_fig / "eta_hist.png", dpi=200)
plt.show()

corr.round(3)
```

# Bayesian SEM Estimation (PyMC)

```{python}
import pymc as pm
import pytensor.tensor as pt
import arviz as az

Y_obs = dfY.values
X_obs = X

n, J = X_obs.shape
K = Y_obs.shape[1]

with pm.Model() as sem_model:
    beta = pm.Normal("beta", mu=0.0, sigma=1.0, shape=J)
    sigma_zeta = pm.HalfNormal("sigma_zeta", sigma=1.0)

    lam = pm.Normal("lambda", mu=1.0, sigma=0.5, shape=K)
    sigma_eps = pm.HalfNormal("sigma_eps", sigma=1.0, shape=K)

    eta_latent = pm.Normal(
        "eta",
        mu=pt.dot(X_obs, beta),
        sigma=sigma_zeta,
        shape=n
    )

    muY = eta_latent[:, None] * lam[None, :]

    pm.Normal("Y", mu=muY, sigma=sigma_eps, observed=Y_obs)

    idata = pm.sample(
        draws=800,
        tune=800,
        chains=2,
        target_accept=0.9,
        random_seed=42,
        progressbar=False
    )

az.summary(idata, var_names=["beta", "lambda", "sigma_zeta", "sigma_eps"], round_to=3)
```

# Posterior Diagnostics

```{python}
#| fig-align: center
#| fig-width: 8
#| fig-height: 5
#| fig-cap: "MCMC trace diagnostics."

az.plot_trace(idata, var_names=["beta", "lambda", "sigma_zeta", "sigma_eps"])
plt.tight_layout()
plt.show()
```

# Parameter Recovery Check

```{python}
post = az.summary(idata, var_names=["beta", "lambda"], round_to=3)

post_mean_beta = post.loc[[f"beta[{j}]" for j in range(J)], "mean"].to_numpy()
post_mean_lam = post.loc[[f"lambda[{k}]" for k in range(K)], "mean"].to_numpy()

comparison = pd.DataFrame({
    "true": np.concatenate([beta_true, lambda_true]),
    "posterior_mean": np.concatenate([post_mean_beta, post_mean_lam])
})

comparison
```

```{python}
#| fig-align: center
#| fig-width: 7
#| fig-height: 4.5
#| fig-cap: "Posterior mean vs true parameter values."

plt.figure()
plt.scatter(comparison["true"], comparison["posterior_mean"])
plt.xlabel("True value")
plt.ylabel("Posterior mean")
plt.plot(
    [comparison["true"].min(), comparison["true"].max()],
    [comparison["true"].min(), comparison["true"].max()]
)
plt.tight_layout()
plt.show()
```

# Integrated Architecture (Conceptual Diagram)

```{mermaid}
%%{init: {
  "theme": "base",
  "themeVariables": {
    "background": "#ffffff",
    "primaryColor": "#ffffff",
    "primaryTextColor": "#111111",
    "primaryBorderColor": "#111111",
    "lineColor": "#111111",
    "fontSize": "12px"
  },
  "flowchart": { "curve": "linear" }
}}%%

flowchart TB

  subgraph S["Red multi-eslabón (tiers)"]
    direction TB
    T3["Tier 3"] --> T2["Tier 2"] --> T1["Tier 1"] --> M["Manufacturer"] --> D["CD"] --> C["Customer"]
  end

  subgraph B["Capa Bayesiana (SEM + BO)"]
    direction TB
    X["Procesos / variables<br/>X_s"] --> ETA["Calidad latente η"]
    ETA --> Y["Criterios Y_{c,k}"]
    Y --> SC["Satisfacción S_c"]
    SC --> U["Utilidad económica U"]
  end

  S --> X
  U --> MILP["MILP: selección de enlaces z<br/>y flujos q"]
  MILP --> S
```

# Customer Satisfaction and Endogenous Demand

Customer satisfaction for product $p$ and customer $c$ is defined as:

$$
S_{c,p} = \sum_{k=1}^{K} w_{c,k} \mathbb{E}[Y_{c,p,k}]
$$ {#eq-satisfaction}

where:

- $w_{c,k}$ represents the importance weight of criterion $k$ for customer $c$,
- $\sum_{k} w_{c,k} = 1$.

Demand is assumed to be endogenous and driven by satisfaction:

$$
d_{c,p} = d_{c,p}^{0} + \alpha_{c,p} S_{c,p}
$$ {#eq-demand}

where:

- $d_{c,p}^{0}$ is the baseline demand,
- $\alpha_{c,p}$ measures sensitivity of demand to satisfaction.



# Economic Utility Function

Total economic utility is defined as:

$$
U = \sum_{c,p} \left( price_{c,p} \cdot q_{c,p} \right)
+ \gamma \sum_{c,p} S_{c,p} q_{c,p}
- C
$$ {#eq-utility}

where:

- $q_{c,p}$ is the quantity delivered to customer $c$,
- $\gamma$ represents the economic impact of satisfaction,
- $C$ is total supply chain cost.


# Cost Structure

Total cost is composed of:

$$
C = C^{var} + C^{struct}
$$ {#eq-cost-total}

Variable cost:

$$
C^{var} = \sum_{(i,j),p} c^{arc}_{i,j,p} q_{i,j,p}
$$ {#eq-cost-var}

Structural cost:

$$
C^{struct} = \sum_{(i,j),p} f_{i,j} z_{i,j,p}
$$ {#eq-cost-struct}


# MILP Formulation

The optimization problem is:

$$
\max U
$$

Subject to:

Flow conservation:

$$
\sum_{i} q_{i,j,p} = \sum_{k} q_{j,k,p}
$$

Capacity constraints:

$$
\sum_{j,p} q_{i,j,p} \leq Cap_i
$$

Link activation constraints:

$$
q_{i,j,p} \leq M z_{i,j,p}
$$

Binary structure:

$$
z_{i,j,p} \in \{0,1\}
$$



# Bayesian Optimization Layer (GP + Expected Improvement)

This section formalizes the Bayesian Optimization (BO) layer used to learn or adapt decision parameters (e.g., customer weights, process targets, or policy parameters) that affect satisfaction and the downstream MILP objective. Let $\boldsymbol{\theta}\in\Theta\subset\mathbb{R}^d$ denote the vector of tunable parameters. Examples include:

- preference weights $\boldsymbol{\theta}=\{w_{c,k}\}$,
- process-control targets $\boldsymbol{\theta}=\{x_{s,j}^{\star}\}$,
- economic trade-off parameters $\boldsymbol{\theta}=\{\gamma,\alpha_{c,p}\}$,
- or any calibration vector that impacts expected satisfaction and utility.

We define the (black-box) BO objective as the **expected economic utility** induced by $\boldsymbol{\theta}$:

$$
f(\boldsymbol{\theta}) \;=\; \mathbb{E}\Big[\, U(\boldsymbol{q}^{\star}(\boldsymbol{\theta}),\boldsymbol{z}^{\star}(\boldsymbol{\theta});\,\boldsymbol{\theta}) \,\Big],
$$ {#eq-bo-obj}

where $(\boldsymbol{q}^{\star}(\boldsymbol{\theta}),\boldsymbol{z}^{\star}(\boldsymbol{\theta}))$ is the MILP optimal solution under parameterization $\boldsymbol{\theta}$, and the expectation is taken with respect to the Bayesian layer uncertainty (SEM posterior and any stochastic components).

## Gaussian Process Surrogate

At iteration $n$, we have evaluated $f$ at $\mathcal{D}_n=\{(\boldsymbol{\theta}_i, y_i)\}_{i=1}^n$, where:

$$
y_i \;=\; f(\boldsymbol{\theta}_i) + \epsilon_i,\qquad \epsilon_i \sim \mathcal{N}(0,\sigma_\epsilon^2).
$$ {#eq-bo-noise}

We place a Gaussian Process prior on $f$:

$$
f(\boldsymbol{\theta}) \sim \mathcal{GP}\big(m(\boldsymbol{\theta}),\,k(\boldsymbol{\theta},\boldsymbol{\theta}')\big),
$$ {#eq-gp-prior}

commonly using a constant mean $m(\boldsymbol{\theta})=m_0$ and an RBF kernel:

$$
k(\boldsymbol{\theta},\boldsymbol{\theta}') \;=\; \sigma_f^2 \exp\!\left(
-\frac{1}{2}\sum_{\ell=1}^{d}\frac{(\theta_\ell-\theta'_\ell)^2}{\rho_\ell^2}
\right).
$$ {#eq-gp-kernel}

Given $\mathcal{D}_n$, the GP posterior at a candidate $\boldsymbol{\theta}$ is Gaussian:

$$
f(\boldsymbol{\theta}) \mid \mathcal{D}_n \;\sim\; \mathcal{N}\!\big(\mu_n(\boldsymbol{\theta}),\,\sigma_n^2(\boldsymbol{\theta})\big),
$$ {#eq-gp-post}

with standard expressions:

$$
\mu_n(\boldsymbol{\theta}) \;=\; m(\boldsymbol{\theta}) + \mathbf{k}_n(\boldsymbol{\theta})^\top
\big(\mathbf{K}_n+\sigma_\epsilon^2\mathbf{I}\big)^{-1}\big(\mathbf{y}-\mathbf{m}_n\big),
$$ {#eq-gp-mu}

$$
\sigma_n^2(\boldsymbol{\theta}) \;=\; k(\boldsymbol{\theta},\boldsymbol{\theta}) -
\mathbf{k}_n(\boldsymbol{\theta})^\top\big(\mathbf{K}_n+\sigma_\epsilon^2\mathbf{I}\big)^{-1}\mathbf{k}_n(\boldsymbol{\theta}),
$$ {#eq-gp-sigma}

where $\mathbf{K}_n=[k(\boldsymbol{\theta}_i,\boldsymbol{\theta}_j)]_{i,j}$, $\mathbf{k}_n(\boldsymbol{\theta})=[k(\boldsymbol{\theta}_1,\boldsymbol{\theta}),\ldots,k(\boldsymbol{\theta}_n,\boldsymbol{\theta})]^\top$, $\mathbf{y}=[y_1,\ldots,y_n]^\top$, and $\mathbf{m}_n=[m(\boldsymbol{\theta}_1),\ldots,m(\boldsymbol{\theta}_n)]^\top$.

## Expected Improvement Acquisition

Let $f_n^{\max}=\max_{i\le n} y_i$ be the best observed value so far. The Expected Improvement (EI) acquisition for maximization is:

$$
\mathrm{EI}_n(\boldsymbol{\theta}) \;=\;
\mathbb{E}\Big[\max\big(0,\, f(\boldsymbol{\theta})-f_n^{\max}-\xi\big)\;\big|\;\mathcal{D}_n\Big],
$$ {#eq-ei-def}

where $\xi\ge 0$ controls exploration. Under the GP posterior \@eq-gp-post, EI has closed form. Define:

$$
Z(\boldsymbol{\theta}) \;=\; \frac{\mu_n(\boldsymbol{\theta})-f_n^{\max}-\xi}{\sigma_n(\boldsymbol{\theta})},
$$ {#eq-ei-z}

then:

$$
\mathrm{EI}_n(\boldsymbol{\theta}) \;=\;
\big(\mu_n(\boldsymbol{\theta})-f_n^{\max}-\xi\big)\Phi\!\big(Z(\boldsymbol{\theta})\big)
+\sigma_n(\boldsymbol{\theta})\phi\!\big(Z(\boldsymbol{\theta})\big),
$$ {#eq-ei-closed}

with $\Phi(\cdot)$ and $\phi(\cdot)$ the standard normal CDF and PDF.

The BO iteration selects the next evaluation point by:

$$
\boldsymbol{\theta}_{n+1} \;=\; \arg\max_{\boldsymbol{\theta}\in\Theta}\;\mathrm{EI}_n(\boldsymbol{\theta}).
$$ {#eq-bo-next}

## Coupling with the Bayesian SEM and MILP

For each candidate $\boldsymbol{\theta}$ evaluated during BO, the workflow is:

1. **SEM posterior propagation:** draw $(\boldsymbol{\beta},\boldsymbol{\lambda},\boldsymbol{\sigma}) \sim p(\cdot\mid \text{data})$ and compute $\mathbb{E}[Y_{c,p,k}\mid X,\boldsymbol{\theta}]$ (or Monte Carlo estimates).
2. **Satisfaction / demand update:** compute $S_{c,p}(\boldsymbol{\theta})$ and any derived demand parameters.
3. **MILP solve:** solve the MILP to obtain $(\boldsymbol{q}^{\star}(\boldsymbol{\theta}),\boldsymbol{z}^{\star}(\boldsymbol{\theta}))$.
4. **Utility evaluation:** compute $y=f(\boldsymbol{\theta})$ as the expected (or Monte Carlo averaged) utility.

This closes the Bayesian loop: BO learns $\boldsymbol{\theta}$ that maximizes the satisfaction-driven expected utility under uncertainty.


# Conclusion

The proposed framework integrates:

- Bayesian Structural Equation Modeling
- Multi-tier supply chain structure
- Endogenous satisfaction-driven demand
- Mixed-integer network optimization

forming a unified architecture for economic utility maximization.

::contentReference[oaicite:0]{index=0}