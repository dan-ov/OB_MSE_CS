<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.27">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Dr.&nbsp;Daniel A. Olivares Vera">
<meta name="dcterms.date" content="2026-02-24">
<meta name="keywords" content="Bayesian Optimization, Structural Equation Modeling, MILP, Supply Chain">

<title>Bayesian–MILP Model for Multi-Tier Supply Chains</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" integrity="sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2" crossorigin="anonymous"></script><script src="index_files/libs/clipboard/clipboard.min.js"></script>
<script src="index_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="index_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="index_files/libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="index_files/libs/quarto-html/popper.min.js"></script>
<script src="index_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="index_files/libs/quarto-html/anchor.min.js"></script>
<link href="index_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="index_files/libs/quarto-html/quarto-syntax-highlighting-ed96de9b727972fe78a7b5d16c58bf87.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="index_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="index_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="index_files/libs/bootstrap/bootstrap-a74871fe4945b66d259aafc266475145.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="index_files/libs/quarto-diagram/mermaid.min.js"></script>
<script src="index_files/libs/quarto-diagram/mermaid-init.js"></script>
<link href="index_files/libs/quarto-diagram/mermaid.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/requirejs@2.3.6/require.min.js" integrity="sha384-c9c+LnTbwQ3aujuU7ULEPVvgLs+Fn6fJUvIGTsuu1ZcCf11fiEubah0ttpca4ntM sha384-6V1/AdqZRWk1KAlWbKBlGhN7VG4iE/yAZcO6NZPMF8od0vukrvr0tg4qY6NSrItx" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">1</span> Introduction</a></li>
  <li><a href="#structural-equation-model-specification" id="toc-structural-equation-model-specification" class="nav-link" data-scroll-target="#structural-equation-model-specification"><span class="header-section-number">2</span> Structural Equation Model Specification</a></li>
  <li><a href="#simulated-sem-results" id="toc-simulated-sem-results" class="nav-link" data-scroll-target="#simulated-sem-results"><span class="header-section-number">3</span> Simulated SEM Results</a></li>
  <li><a href="#bayesian-sem-estimation-pymc" id="toc-bayesian-sem-estimation-pymc" class="nav-link" data-scroll-target="#bayesian-sem-estimation-pymc"><span class="header-section-number">4</span> Bayesian SEM Estimation (PyMC)</a></li>
  <li><a href="#posterior-diagnostics" id="toc-posterior-diagnostics" class="nav-link" data-scroll-target="#posterior-diagnostics"><span class="header-section-number">5</span> Posterior Diagnostics</a></li>
  <li><a href="#parameter-recovery-check" id="toc-parameter-recovery-check" class="nav-link" data-scroll-target="#parameter-recovery-check"><span class="header-section-number">6</span> Parameter Recovery Check</a></li>
  <li><a href="#integrated-architecture-conceptual-diagram" id="toc-integrated-architecture-conceptual-diagram" class="nav-link" data-scroll-target="#integrated-architecture-conceptual-diagram"><span class="header-section-number">7</span> Integrated Architecture (Conceptual Diagram)</a></li>
  <li><a href="#customer-satisfaction-and-endogenous-demand" id="toc-customer-satisfaction-and-endogenous-demand" class="nav-link" data-scroll-target="#customer-satisfaction-and-endogenous-demand"><span class="header-section-number">8</span> Customer Satisfaction and Endogenous Demand</a></li>
  <li><a href="#economic-utility-function" id="toc-economic-utility-function" class="nav-link" data-scroll-target="#economic-utility-function"><span class="header-section-number">9</span> Economic Utility Function</a></li>
  <li><a href="#cost-structure" id="toc-cost-structure" class="nav-link" data-scroll-target="#cost-structure"><span class="header-section-number">10</span> Cost Structure</a></li>
  <li><a href="#milp-formulation" id="toc-milp-formulation" class="nav-link" data-scroll-target="#milp-formulation"><span class="header-section-number">11</span> MILP Formulation</a></li>
  <li><a href="#bayesian-optimization-layer-gp-expected-improvement" id="toc-bayesian-optimization-layer-gp-expected-improvement" class="nav-link" data-scroll-target="#bayesian-optimization-layer-gp-expected-improvement"><span class="header-section-number">12</span> Bayesian Optimization Layer (GP + Expected Improvement)</a>
  <ul class="collapse">
  <li><a href="#gaussian-process-surrogate" id="toc-gaussian-process-surrogate" class="nav-link" data-scroll-target="#gaussian-process-surrogate"><span class="header-section-number">12.1</span> Gaussian Process Surrogate</a></li>
  <li><a href="#expected-improvement-acquisition" id="toc-expected-improvement-acquisition" class="nav-link" data-scroll-target="#expected-improvement-acquisition"><span class="header-section-number">12.2</span> Expected Improvement Acquisition</a></li>
  <li><a href="#coupling-with-the-bayesian-sem-and-milp" id="toc-coupling-with-the-bayesian-sem-and-milp" class="nav-link" data-scroll-target="#coupling-with-the-bayesian-sem-and-milp"><span class="header-section-number">12.3</span> Coupling with the Bayesian SEM and MILP</a></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion"><span class="header-section-number">13</span> Conclusion</a></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="index.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Bayesian–MILP Model for Multi-Tier Supply Chains</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
<p class="subtitle lead">Integrating Structural Equation Modeling and Customer Satisfaction Optimization</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Dr.&nbsp;Daniel A. Olivares Vera </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 24, 2026</p>
    </div>
  </div>
  
    
  </div>
  
<div>
  <div class="abstract">
    <div class="block-title">Abstract</div>
    <p>This paper proposes a Bayesian–MILP model that integrates structural equation modeling (SEM), Bayesian optimization (BO), and mixed-integer linear programming (MILP) for multi-tier supply chains oriented to customer value maximization.</p>
  </div>
</div>

<div>
  <div class="keywords">
    <div class="block-title">Keywords</div>
    <p>Bayesian Optimization, Structural Equation Modeling, MILP, Supply Chain</p>
  </div>
</div>

</header>


<p><a href="index.pdf">Download PDF version</a></p>
<section id="introduction" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introduction</h1>
<p>Traditional supply chain optimization focuses primarily on cost minimization or efficiency maximization. However, in multi-tier supply networks, upstream process decisions may strongly influence downstream customer satisfaction through latent quality constructs.</p>
</section>
<section id="structural-equation-model-specification" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Structural Equation Model Specification</h1>
<p>The hierarchical SEM is defined as follows:</p>
<p><span id="eq-eta"><span class="math display">\[
\eta_i = \mathbf{x}_i^\top \boldsymbol{\beta} + \zeta_i
\tag{1}\]</span></span></p>
<p><span id="eq-measure"><span class="math display">\[
Y_{ik} = \lambda_k \eta_i + \varepsilon_{ik}
\tag{2}\]</span></span></p>
<p>where:</p>
<ul>
<li><span class="math inline">\(\mathbf{x}_i\)</span> is the vector of process variables,</li>
<li><span class="math inline">\(\boldsymbol{\beta}\)</span> are structural coefficients,</li>
<li><span class="math inline">\(\lambda_k\)</span> are measurement loadings,</li>
<li><span class="math inline">\(\zeta_i \sim \mathcal{N}(0, \sigma_\zeta^2)\)</span>,</li>
<li><span class="math inline">\(\varepsilon_{ik} \sim \mathcal{N}(0, \sigma_{\varepsilon_k}^2)\)</span>.</li>
</ul>
<p>As shown in Eq. <a href="#eq-eta" class="quarto-xref">Equation&nbsp;1</a> and Eq. <a href="#eq-measure" class="quarto-xref">Equation&nbsp;2</a>,</p>
<p>Como se muestra en la Figura <a href="#fig-arquitectura" class="quarto-xref">Figure&nbsp;1</a>, el modelo integra la red multi-eslabón con la capa Bayesiana y la capa de optimización.</p>
<div id="fig-arquitectura" class="quarto-float quarto-figure quarto-figure-center anchored" width="40%" data-fig-cap="Arquitectura general del modelo.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-arquitectura-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/Dan(2026)v2.png" id="fig-arquitectura" class="img-fluid figure-img" style="width:40.0%" data-fig-cap="Arquitectura general del modelo.">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-arquitectura-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1
</figcaption>
</figure>
</div>
</section>
<section id="simulated-sem-results" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Simulated SEM Results</h1>
<div id="62f9912d" class="cell" data-fig-height="4.5" data-fig-width="7" data-execution_count="1">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">42</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>out_fig <span class="op">=</span> Path(<span class="st">"results/figures"</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>out_tab <span class="op">=</span> Path(<span class="st">"results/tables"</span>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>out_fig.mkdir(parents<span class="op">=</span><span class="va">True</span>, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>out_tab.mkdir(parents<span class="op">=</span><span class="va">True</span>, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>n_products <span class="op">=</span> <span class="dv">200</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>n_attributes <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>n_process_vars <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>beta_true <span class="op">=</span> np.random.normal(<span class="dv">0</span>, <span class="fl">0.8</span>, n_process_vars)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>lambda_true <span class="op">=</span> np.array([<span class="fl">0.9</span>, <span class="fl">1.1</span>, <span class="fl">0.8</span>])</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>sigma_zeta_true <span class="op">=</span> <span class="fl">0.5</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>sigma_eps_true <span class="op">=</span> np.array([<span class="fl">0.4</span>, <span class="fl">0.3</span>, <span class="fl">0.5</span>])</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> np.random.normal(<span class="dv">0</span>, <span class="dv">1</span>, (n_products, n_process_vars))</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>zeta <span class="op">=</span> np.random.normal(<span class="dv">0</span>, sigma_zeta_true, n_products)</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>eta <span class="op">=</span> X <span class="op">@</span> beta_true <span class="op">+</span> zeta</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> np.zeros((n_products, n_attributes))</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> <span class="bu">range</span>(n_attributes):</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>    eps <span class="op">=</span> np.random.normal(<span class="dv">0</span>, sigma_eps_true[k], n_products)</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>    Y[:, k] <span class="op">=</span> lambda_true[k] <span class="op">*</span> eta <span class="op">+</span> eps</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>dfY <span class="op">=</span> pd.DataFrame(Y, columns<span class="op">=</span>[<span class="st">"Durability"</span>, <span class="st">"Appearance"</span>, <span class="st">"Comfort"</span>])</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>corr <span class="op">=</span> dfY.corr()</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>corr.to_csv(out_tab <span class="op">/</span> <span class="st">"corr_attributes.csv"</span>, index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>plt.figure()</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>plt.hist(eta, bins<span class="op">=</span><span class="dv">30</span>)</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Simulated latent quality η"</span>)</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>plt.savefig(out_fig <span class="op">/</span> <span class="st">"eta_hist.png"</span>, dpi<span class="op">=</span><span class="dv">200</span>)</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>corr.<span class="bu">round</span>(<span class="dv">3</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/cell-2-output-1.png" width="662" height="469" class="figure-img"></p>
<figcaption>Distribution of simulated latent quality (η).</figcaption>
</figure>
</div>
</div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Durability</th>
<th data-quarto-table-cell-role="th">Appearance</th>
<th data-quarto-table-cell-role="th">Comfort</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">Durability</th>
<td>1.000</td>
<td>0.934</td>
<td>0.869</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Appearance</th>
<td>0.934</td>
<td>1.000</td>
<td>0.899</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Comfort</th>
<td>0.869</td>
<td>0.899</td>
<td>1.000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="bayesian-sem-estimation-pymc" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Bayesian SEM Estimation (PyMC)</h1>
<div id="64e0ac9b" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pymc <span class="im">as</span> pm</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pytensor.tensor <span class="im">as</span> pt</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> arviz <span class="im">as</span> az</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>Y_obs <span class="op">=</span> dfY.values</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>X_obs <span class="op">=</span> X</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>n, J <span class="op">=</span> X_obs.shape</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>K <span class="op">=</span> Y_obs.shape[<span class="dv">1</span>]</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> pm.Model() <span class="im">as</span> sem_model:</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    beta <span class="op">=</span> pm.Normal(<span class="st">"beta"</span>, mu<span class="op">=</span><span class="fl">0.0</span>, sigma<span class="op">=</span><span class="fl">1.0</span>, shape<span class="op">=</span>J)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    sigma_zeta <span class="op">=</span> pm.HalfNormal(<span class="st">"sigma_zeta"</span>, sigma<span class="op">=</span><span class="fl">1.0</span>)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    lam <span class="op">=</span> pm.Normal(<span class="st">"lambda"</span>, mu<span class="op">=</span><span class="fl">1.0</span>, sigma<span class="op">=</span><span class="fl">0.5</span>, shape<span class="op">=</span>K)</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    sigma_eps <span class="op">=</span> pm.HalfNormal(<span class="st">"sigma_eps"</span>, sigma<span class="op">=</span><span class="fl">1.0</span>, shape<span class="op">=</span>K)</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    eta_latent <span class="op">=</span> pm.Normal(</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>        <span class="st">"eta"</span>,</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>        mu<span class="op">=</span>pt.dot(X_obs, beta),</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>        sigma<span class="op">=</span>sigma_zeta,</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>        shape<span class="op">=</span>n</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>    muY <span class="op">=</span> eta_latent[:, <span class="va">None</span>] <span class="op">*</span> lam[<span class="va">None</span>, :]</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>    pm.Normal(<span class="st">"Y"</span>, mu<span class="op">=</span>muY, sigma<span class="op">=</span>sigma_eps, observed<span class="op">=</span>Y_obs)</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>    idata <span class="op">=</span> pm.sample(</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>        draws<span class="op">=</span><span class="dv">800</span>,</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>        tune<span class="op">=</span><span class="dv">800</span>,</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>        chains<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>        target_accept<span class="op">=</span><span class="fl">0.9</span>,</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>        random_seed<span class="op">=</span><span class="dv">42</span>,</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>        progressbar<span class="op">=</span><span class="va">False</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>az.summary(idata, var_names<span class="op">=</span>[<span class="st">"beta"</span>, <span class="st">"lambda"</span>, <span class="st">"sigma_zeta"</span>, <span class="st">"sigma_eps"</span>], round_to<span class="op">=</span><span class="dv">3</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="2">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">mean</th>
<th data-quarto-table-cell-role="th">sd</th>
<th data-quarto-table-cell-role="th">hdi_3%</th>
<th data-quarto-table-cell-role="th">hdi_97%</th>
<th data-quarto-table-cell-role="th">mcse_mean</th>
<th data-quarto-table-cell-role="th">mcse_sd</th>
<th data-quarto-table-cell-role="th">ess_bulk</th>
<th data-quarto-table-cell-role="th">ess_tail</th>
<th data-quarto-table-cell-role="th">r_hat</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">beta[0]</th>
<td>0.485</td>
<td>0.099</td>
<td>0.306</td>
<td>0.666</td>
<td>0.025</td>
<td>0.007</td>
<td>14.622</td>
<td>85.950</td>
<td>1.098</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">beta[1]</th>
<td>-0.124</td>
<td>0.053</td>
<td>-0.220</td>
<td>-0.020</td>
<td>0.005</td>
<td>0.002</td>
<td>109.609</td>
<td>410.665</td>
<td>1.018</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">beta[2]</th>
<td>0.570</td>
<td>0.111</td>
<td>0.368</td>
<td>0.766</td>
<td>0.026</td>
<td>0.008</td>
<td>17.392</td>
<td>72.167</td>
<td>1.097</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">beta[3]</th>
<td>1.386</td>
<td>0.240</td>
<td>0.934</td>
<td>1.808</td>
<td>0.067</td>
<td>0.022</td>
<td>13.269</td>
<td>45.011</td>
<td>1.127</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">beta[4]</th>
<td>-0.165</td>
<td>0.055</td>
<td>-0.263</td>
<td>-0.061</td>
<td>0.008</td>
<td>0.001</td>
<td>46.888</td>
<td>464.406</td>
<td>1.036</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">lambda[0]</th>
<td>0.776</td>
<td>0.143</td>
<td>0.563</td>
<td>1.053</td>
<td>0.043</td>
<td>0.017</td>
<td>14.097</td>
<td>45.235</td>
<td>1.124</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">lambda[1]</th>
<td>0.968</td>
<td>0.178</td>
<td>0.694</td>
<td>1.301</td>
<td>0.053</td>
<td>0.021</td>
<td>14.190</td>
<td>41.852</td>
<td>1.127</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">lambda[2]</th>
<td>0.709</td>
<td>0.132</td>
<td>0.499</td>
<td>0.957</td>
<td>0.039</td>
<td>0.015</td>
<td>14.669</td>
<td>47.337</td>
<td>1.121</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">sigma_zeta</th>
<td>0.627</td>
<td>0.117</td>
<td>0.418</td>
<td>0.828</td>
<td>0.031</td>
<td>0.010</td>
<td>14.858</td>
<td>72.299</td>
<td>1.113</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">sigma_eps[0]</th>
<td>0.403</td>
<td>0.028</td>
<td>0.352</td>
<td>0.454</td>
<td>0.001</td>
<td>0.001</td>
<td>695.670</td>
<td>1067.204</td>
<td>1.006</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">sigma_eps[1]</th>
<td>0.311</td>
<td>0.039</td>
<td>0.236</td>
<td>0.385</td>
<td>0.003</td>
<td>0.001</td>
<td>156.141</td>
<td>200.884</td>
<td>1.023</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">sigma_eps[2]</th>
<td>0.504</td>
<td>0.029</td>
<td>0.454</td>
<td>0.559</td>
<td>0.001</td>
<td>0.001</td>
<td>951.830</td>
<td>1221.667</td>
<td>1.002</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="posterior-diagnostics" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Posterior Diagnostics</h1>
<div id="c0af60d6" class="cell" data-fig-height="5" data-fig-width="8" data-execution_count="3">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>az.plot_trace(idata, var_names<span class="op">=</span>[<span class="st">"beta"</span>, <span class="st">"lambda"</span>, <span class="st">"sigma_zeta"</span>, <span class="st">"sigma_eps"</span>])</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/cell-4-output-1.png" width="1140" height="757" class="figure-img"></p>
<figcaption>MCMC trace diagnostics.</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="parameter-recovery-check" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Parameter Recovery Check</h1>
<div id="a62dc8fd" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>post <span class="op">=</span> az.summary(idata, var_names<span class="op">=</span>[<span class="st">"beta"</span>, <span class="st">"lambda"</span>], round_to<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>post_mean_beta <span class="op">=</span> post.loc[[<span class="ss">f"beta[</span><span class="sc">{</span>j<span class="sc">}</span><span class="ss">]"</span> <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(J)], <span class="st">"mean"</span>].to_numpy()</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>post_mean_lam <span class="op">=</span> post.loc[[<span class="ss">f"lambda[</span><span class="sc">{</span>k<span class="sc">}</span><span class="ss">]"</span> <span class="cf">for</span> k <span class="kw">in</span> <span class="bu">range</span>(K)], <span class="st">"mean"</span>].to_numpy()</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>comparison <span class="op">=</span> pd.DataFrame({</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"true"</span>: np.concatenate([beta_true, lambda_true]),</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"posterior_mean"</span>: np.concatenate([post_mean_beta, post_mean_lam])</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>comparison</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="4">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">true</th>
<th data-quarto-table-cell-role="th">posterior_mean</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>0.397371</td>
<td>0.485</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>-0.110611</td>
<td>-0.124</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>0.518151</td>
<td>0.570</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>1.218424</td>
<td>1.386</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>-0.187323</td>
<td>-0.165</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">5</th>
<td>0.900000</td>
<td>0.776</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">6</th>
<td>1.100000</td>
<td>0.968</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">7</th>
<td>0.800000</td>
<td>0.709</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="ee1cbdbe" class="cell" data-fig-height="4.5" data-fig-width="7" data-execution_count="5">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>plt.figure()</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>plt.scatter(comparison[<span class="st">"true"</span>], comparison[<span class="st">"posterior_mean"</span>])</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"True value"</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Posterior mean"</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>plt.plot(</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    [comparison[<span class="st">"true"</span>].<span class="bu">min</span>(), comparison[<span class="st">"true"</span>].<span class="bu">max</span>()],</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    [comparison[<span class="st">"true"</span>].<span class="bu">min</span>(), comparison[<span class="st">"true"</span>].<span class="bu">max</span>()]</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/cell-6-output-1.png" width="661" height="468" class="figure-img"></p>
<figcaption>Posterior mean vs true parameter values.</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="integrated-architecture-conceptual-diagram" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Integrated Architecture (Conceptual Diagram)</h1>
<div class="cell" data-layout-align="default">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>%%{init: {</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  "theme": "base",</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  "themeVariables": {</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    "background": "#ffffff",</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    "primaryColor": "#ffffff",</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    "primaryTextColor": "#111111",</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    "primaryBorderColor": "#111111",</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    "lineColor": "#111111",</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    "fontSize": "12px"</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  },</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  "flowchart": { "curve": "linear" }</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>}}%%</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>flowchart TB</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>  subgraph S["Red multi-eslabón (tiers)"]</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>    direction TB</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>    T3["Tier 3"] --&gt; T2["Tier 2"] --&gt; T1["Tier 1"] --&gt; M["Manufacturer"] --&gt; D["CD"] --&gt; C["Customer"]</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>  end</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>  subgraph B["Capa Bayesiana (SEM + BO)"]</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>    direction TB</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>    X["Procesos / variables&lt;br/&gt;X_s"] --&gt; ETA["Calidad latente η"]</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>    ETA --&gt; Y["Criterios Y_{c,k}"]</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>    Y --&gt; SC["Satisfacción S_c"]</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>    SC --&gt; U["Utilidad económica U"]</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>  end</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>  S --&gt; X</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>  U --&gt; MILP["MILP: selección de enlaces z&lt;br/&gt;y flujos q"]</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>  MILP --&gt; S</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">%%{init: {
  "theme": "base",
  "themeVariables": {
    "background": "#ffffff",
    "primaryColor": "#ffffff",
    "primaryTextColor": "#111111",
    "primaryBorderColor": "#111111",
    "lineColor": "#111111",
    "fontSize": "12px"
  },
  "flowchart": { "curve": "linear" }
}}%%

flowchart TB

  subgraph S["Red multi-eslabón (tiers)"]
    direction TB
    T3["Tier 3"] --&gt; T2["Tier 2"] --&gt; T1["Tier 1"] --&gt; M["Manufacturer"] --&gt; D["CD"] --&gt; C["Customer"]
  end

  subgraph B["Capa Bayesiana (SEM + BO)"]
    direction TB
    X["Procesos / variables&lt;br/&gt;X_s"] --&gt; ETA["Calidad latente η"]
    ETA --&gt; Y["Criterios Y_{c,k}"]
    Y --&gt; SC["Satisfacción S_c"]
    SC --&gt; U["Utilidad económica U"]
  end

  S --&gt; X
  U --&gt; MILP["MILP: selección de enlaces z&lt;br/&gt;y flujos q"]
  MILP --&gt; S
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
</section>
<section id="customer-satisfaction-and-endogenous-demand" class="level1" data-number="8">
<h1 data-number="8"><span class="header-section-number">8</span> Customer Satisfaction and Endogenous Demand</h1>
<p>Customer satisfaction for product <span class="math inline">\(p\)</span> and customer <span class="math inline">\(c\)</span> is defined as:</p>
<p><span id="eq-satisfaction"><span class="math display">\[
S_{c,p} = \sum_{k=1}^{K} w_{c,k} \mathbb{E}[Y_{c,p,k}]
\tag{3}\]</span></span></p>
<p>where:</p>
<ul>
<li><span class="math inline">\(w_{c,k}\)</span> represents the importance weight of criterion <span class="math inline">\(k\)</span> for customer <span class="math inline">\(c\)</span>,</li>
<li><span class="math inline">\(\sum_{k} w_{c,k} = 1\)</span>.</li>
</ul>
<p>Demand is assumed to be endogenous and driven by satisfaction:</p>
<p><span id="eq-demand"><span class="math display">\[
d_{c,p} = d_{c,p}^{0} + \alpha_{c,p} S_{c,p}
\tag{4}\]</span></span></p>
<p>where:</p>
<ul>
<li><span class="math inline">\(d_{c,p}^{0}\)</span> is the baseline demand,</li>
<li><span class="math inline">\(\alpha_{c,p}\)</span> measures sensitivity of demand to satisfaction.</li>
</ul>
</section>
<section id="economic-utility-function" class="level1" data-number="9">
<h1 data-number="9"><span class="header-section-number">9</span> Economic Utility Function</h1>
<p>Total economic utility is defined as:</p>
<p><span id="eq-utility"><span class="math display">\[
U = \sum_{c,p} \left( price_{c,p} \cdot q_{c,p} \right)
+ \gamma \sum_{c,p} S_{c,p} q_{c,p}
- C
\tag{5}\]</span></span></p>
<p>where:</p>
<ul>
<li><span class="math inline">\(q_{c,p}\)</span> is the quantity delivered to customer <span class="math inline">\(c\)</span>,</li>
<li><span class="math inline">\(\gamma\)</span> represents the economic impact of satisfaction,</li>
<li><span class="math inline">\(C\)</span> is total supply chain cost.</li>
</ul>
</section>
<section id="cost-structure" class="level1" data-number="10">
<h1 data-number="10"><span class="header-section-number">10</span> Cost Structure</h1>
<p>Total cost is composed of:</p>
<p><span id="eq-cost-total"><span class="math display">\[
C = C^{var} + C^{struct}
\tag{6}\]</span></span></p>
<p>Variable cost:</p>
<p><span id="eq-cost-var"><span class="math display">\[
C^{var} = \sum_{(i,j),p} c^{arc}_{i,j,p} q_{i,j,p}
\tag{7}\]</span></span></p>
<p>Structural cost:</p>
<p><span id="eq-cost-struct"><span class="math display">\[
C^{struct} = \sum_{(i,j),p} f_{i,j} z_{i,j,p}
\tag{8}\]</span></span></p>
</section>
<section id="milp-formulation" class="level1" data-number="11">
<h1 data-number="11"><span class="header-section-number">11</span> MILP Formulation</h1>
<p>The optimization problem is:</p>
<p><span class="math display">\[
\max U
\]</span></p>
<p>Subject to:</p>
<p>Flow conservation:</p>
<p><span class="math display">\[
\sum_{i} q_{i,j,p} = \sum_{k} q_{j,k,p}
\]</span></p>
<p>Capacity constraints:</p>
<p><span class="math display">\[
\sum_{j,p} q_{i,j,p} \leq Cap_i
\]</span></p>
<p>Link activation constraints:</p>
<p><span class="math display">\[
q_{i,j,p} \leq M z_{i,j,p}
\]</span></p>
<p>Binary structure:</p>
<p><span class="math display">\[
z_{i,j,p} \in \{0,1\}
\]</span></p>
</section>
<section id="bayesian-optimization-layer-gp-expected-improvement" class="level1" data-number="12">
<h1 data-number="12"><span class="header-section-number">12</span> Bayesian Optimization Layer (GP + Expected Improvement)</h1>
<p>This section formalizes the Bayesian Optimization (BO) layer used to learn or adapt decision parameters (e.g., customer weights, process targets, or policy parameters) that affect satisfaction and the downstream MILP objective. Let <span class="math inline">\(\boldsymbol{\theta}\in\Theta\subset\mathbb{R}^d\)</span> denote the vector of tunable parameters. Examples include:</p>
<ul>
<li>preference weights <span class="math inline">\(\boldsymbol{\theta}=\{w_{c,k}\}\)</span>,</li>
<li>process-control targets <span class="math inline">\(\boldsymbol{\theta}=\{x_{s,j}^{\star}\}\)</span>,</li>
<li>economic trade-off parameters <span class="math inline">\(\boldsymbol{\theta}=\{\gamma,\alpha_{c,p}\}\)</span>,</li>
<li>or any calibration vector that impacts expected satisfaction and utility.</li>
</ul>
<p>We define the (black-box) BO objective as the <strong>expected economic utility</strong> induced by <span class="math inline">\(\boldsymbol{\theta}\)</span>:</p>
<p><span id="eq-bo-obj"><span class="math display">\[
f(\boldsymbol{\theta}) \;=\; \mathbb{E}\Big[\, U(\boldsymbol{q}^{\star}(\boldsymbol{\theta}),\boldsymbol{z}^{\star}(\boldsymbol{\theta});\,\boldsymbol{\theta}) \,\Big],
\tag{9}\]</span></span></p>
<p>where <span class="math inline">\((\boldsymbol{q}^{\star}(\boldsymbol{\theta}),\boldsymbol{z}^{\star}(\boldsymbol{\theta}))\)</span> is the MILP optimal solution under parameterization <span class="math inline">\(\boldsymbol{\theta}\)</span>, and the expectation is taken with respect to the Bayesian layer uncertainty (SEM posterior and any stochastic components).</p>
<section id="gaussian-process-surrogate" class="level2" data-number="12.1">
<h2 data-number="12.1" class="anchored" data-anchor-id="gaussian-process-surrogate"><span class="header-section-number">12.1</span> Gaussian Process Surrogate</h2>
<p>At iteration <span class="math inline">\(n\)</span>, we have evaluated <span class="math inline">\(f\)</span> at <span class="math inline">\(\mathcal{D}_n=\{(\boldsymbol{\theta}_i, y_i)\}_{i=1}^n\)</span>, where:</p>
<p><span id="eq-bo-noise"><span class="math display">\[
y_i \;=\; f(\boldsymbol{\theta}_i) + \epsilon_i,\qquad \epsilon_i \sim \mathcal{N}(0,\sigma_\epsilon^2).
\tag{10}\]</span></span></p>
<p>We place a Gaussian Process prior on <span class="math inline">\(f\)</span>:</p>
<p><span id="eq-gp-prior"><span class="math display">\[
f(\boldsymbol{\theta}) \sim \mathcal{GP}\big(m(\boldsymbol{\theta}),\,k(\boldsymbol{\theta},\boldsymbol{\theta}')\big),
\tag{11}\]</span></span></p>
<p>commonly using a constant mean <span class="math inline">\(m(\boldsymbol{\theta})=m_0\)</span> and an RBF kernel:</p>
<p><span id="eq-gp-kernel"><span class="math display">\[
k(\boldsymbol{\theta},\boldsymbol{\theta}') \;=\; \sigma_f^2 \exp\!\left(
-\frac{1}{2}\sum_{\ell=1}^{d}\frac{(\theta_\ell-\theta'_\ell)^2}{\rho_\ell^2}
\right).
\tag{12}\]</span></span></p>
<p>Given <span class="math inline">\(\mathcal{D}_n\)</span>, the GP posterior at a candidate <span class="math inline">\(\boldsymbol{\theta}\)</span> is Gaussian:</p>
<p><span id="eq-gp-post"><span class="math display">\[
f(\boldsymbol{\theta}) \mid \mathcal{D}_n \;\sim\; \mathcal{N}\!\big(\mu_n(\boldsymbol{\theta}),\,\sigma_n^2(\boldsymbol{\theta})\big),
\tag{13}\]</span></span></p>
<p>with standard expressions:</p>
<p><span id="eq-gp-mu"><span class="math display">\[
\mu_n(\boldsymbol{\theta}) \;=\; m(\boldsymbol{\theta}) + \mathbf{k}_n(\boldsymbol{\theta})^\top
\big(\mathbf{K}_n+\sigma_\epsilon^2\mathbf{I}\big)^{-1}\big(\mathbf{y}-\mathbf{m}_n\big),
\tag{14}\]</span></span></p>
<p><span id="eq-gp-sigma"><span class="math display">\[
\sigma_n^2(\boldsymbol{\theta}) \;=\; k(\boldsymbol{\theta},\boldsymbol{\theta}) -
\mathbf{k}_n(\boldsymbol{\theta})^\top\big(\mathbf{K}_n+\sigma_\epsilon^2\mathbf{I}\big)^{-1}\mathbf{k}_n(\boldsymbol{\theta}),
\tag{15}\]</span></span></p>
<p>where <span class="math inline">\(\mathbf{K}_n=[k(\boldsymbol{\theta}_i,\boldsymbol{\theta}_j)]_{i,j}\)</span>, <span class="math inline">\(\mathbf{k}_n(\boldsymbol{\theta})=[k(\boldsymbol{\theta}_1,\boldsymbol{\theta}),\ldots,k(\boldsymbol{\theta}_n,\boldsymbol{\theta})]^\top\)</span>, <span class="math inline">\(\mathbf{y}=[y_1,\ldots,y_n]^\top\)</span>, and <span class="math inline">\(\mathbf{m}_n=[m(\boldsymbol{\theta}_1),\ldots,m(\boldsymbol{\theta}_n)]^\top\)</span>.</p>
</section>
<section id="expected-improvement-acquisition" class="level2" data-number="12.2">
<h2 data-number="12.2" class="anchored" data-anchor-id="expected-improvement-acquisition"><span class="header-section-number">12.2</span> Expected Improvement Acquisition</h2>
<p>Let <span class="math inline">\(f_n^{\max}=\max_{i\le n} y_i\)</span> be the best observed value so far. The Expected Improvement (EI) acquisition for maximization is:</p>
<p><span id="eq-ei-def"><span class="math display">\[
\mathrm{EI}_n(\boldsymbol{\theta}) \;=\;
\mathbb{E}\Big[\max\big(0,\, f(\boldsymbol{\theta})-f_n^{\max}-\xi\big)\;\big|\;\mathcal{D}_n\Big],
\tag{16}\]</span></span></p>
<p>where <span class="math inline">\(\xi\ge 0\)</span> controls exploration. Under the GP posterior @eq-gp-post, EI has closed form. Define:</p>
<p><span id="eq-ei-z"><span class="math display">\[
Z(\boldsymbol{\theta}) \;=\; \frac{\mu_n(\boldsymbol{\theta})-f_n^{\max}-\xi}{\sigma_n(\boldsymbol{\theta})},
\tag{17}\]</span></span></p>
<p>then:</p>
<p><span id="eq-ei-closed"><span class="math display">\[
\mathrm{EI}_n(\boldsymbol{\theta}) \;=\;
\big(\mu_n(\boldsymbol{\theta})-f_n^{\max}-\xi\big)\Phi\!\big(Z(\boldsymbol{\theta})\big)
+\sigma_n(\boldsymbol{\theta})\phi\!\big(Z(\boldsymbol{\theta})\big),
\tag{18}\]</span></span></p>
<p>with <span class="math inline">\(\Phi(\cdot)\)</span> and <span class="math inline">\(\phi(\cdot)\)</span> the standard normal CDF and PDF.</p>
<p>The BO iteration selects the next evaluation point by:</p>
<p><span id="eq-bo-next"><span class="math display">\[
\boldsymbol{\theta}_{n+1} \;=\; \arg\max_{\boldsymbol{\theta}\in\Theta}\;\mathrm{EI}_n(\boldsymbol{\theta}).
\tag{19}\]</span></span></p>
</section>
<section id="coupling-with-the-bayesian-sem-and-milp" class="level2" data-number="12.3">
<h2 data-number="12.3" class="anchored" data-anchor-id="coupling-with-the-bayesian-sem-and-milp"><span class="header-section-number">12.3</span> Coupling with the Bayesian SEM and MILP</h2>
<p>For each candidate <span class="math inline">\(\boldsymbol{\theta}\)</span> evaluated during BO, the workflow is:</p>
<ol type="1">
<li><strong>SEM posterior propagation:</strong> draw <span class="math inline">\((\boldsymbol{\beta},\boldsymbol{\lambda},\boldsymbol{\sigma}) \sim p(\cdot\mid \text{data})\)</span> and compute <span class="math inline">\(\mathbb{E}[Y_{c,p,k}\mid X,\boldsymbol{\theta}]\)</span> (or Monte Carlo estimates).</li>
<li><strong>Satisfaction / demand update:</strong> compute <span class="math inline">\(S_{c,p}(\boldsymbol{\theta})\)</span> and any derived demand parameters.</li>
<li><strong>MILP solve:</strong> solve the MILP to obtain <span class="math inline">\((\boldsymbol{q}^{\star}(\boldsymbol{\theta}),\boldsymbol{z}^{\star}(\boldsymbol{\theta}))\)</span>.</li>
<li><strong>Utility evaluation:</strong> compute <span class="math inline">\(y=f(\boldsymbol{\theta})\)</span> as the expected (or Monte Carlo averaged) utility.</li>
</ol>
<p>This closes the Bayesian loop: BO learns <span class="math inline">\(\boldsymbol{\theta}\)</span> that maximizes the satisfaction-driven expected utility under uncertainty.</p>
</section>
</section>
<section id="conclusion" class="level1" data-number="13">
<h1 data-number="13"><span class="header-section-number">13</span> Conclusion</h1>
<p>The proposed framework integrates:</p>
<ul>
<li>Bayesian Structural Equation Modeling</li>
<li>Multi-tier supply chain structure</li>
<li>Endogenous satisfaction-driven demand</li>
<li>Mixed-integer network optimization</li>
</ul>
<p>forming a unified architecture for economic utility maximization.</p>
<p>::contentReference<span data-index="0">oaicite:0</span></p>
<!-- -->

</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb7" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Bayesian–MILP Model for Multi-Tier Supply Chains"</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "Integrating Structural Equation Modeling and Customer Satisfaction Optimization"</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Dr. Daniel A. Olivares Vera"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> today</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="an">abstract:</span><span class="co"> |</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co">  This paper proposes a Bayesian–MILP model that integrates structural equation</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co">  modeling (SEM), Bayesian optimization (BO), and mixed-integer linear programming (MILP)</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co">  for multi-tier supply chains oriented to customer value maximization.</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="an">keywords:</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="co">  - Bayesian Optimization</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="co">  - Structural Equation Modeling</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="co">  - MILP</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="co">  - Supply Chain</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a><span class="co">    number-sections: true</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a><span class="co">    theme: cosmo</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a><span class="co">    html-math-method:</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a><span class="co">      method: mathjax</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a><span class="co">      options:</span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a><span class="co">        tex:</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a><span class="co">          tags: ams</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a><span class="co">  pdf:</span></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a><span class="co">    number-sections: true</span></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a><span class="co">    documentclass: article</span></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a><span class="co">    pdf-engine: lualatex</span></span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a><span class="co">    geometry: margin=1in</span></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a><span class="co">    fontsize: 12pt</span></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a><span class="co">    include-in-header:</span></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a><span class="co">      text: |</span></span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a><span class="co">        \usepackage{lineno}</span></span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a><span class="co">        \linenumbers</span></span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span></span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a><span class="co">  echo: true</span></span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a><span class="co">  warning: false</span></span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a><span class="co">  message: false</span></span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a><span class="co">  freeze: false</span></span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">Download PDF version</span><span class="co">](index.pdf)</span></span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a><span class="fu"># Introduction</span></span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a>Traditional supply chain optimization focuses primarily on cost minimization</span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a>or efficiency maximization. However, in multi-tier supply networks, upstream</span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a>process decisions may strongly influence downstream customer satisfaction</span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a>through latent quality constructs.</span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a><span class="fu"># Structural Equation Model Specification</span></span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true" tabindex="-1"></a>The hierarchical SEM is defined as follows:</span>
<span id="cb7-61"><a href="#cb7-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-62"><a href="#cb7-62" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb7-63"><a href="#cb7-63" aria-hidden="true" tabindex="-1"></a>\eta_i = \mathbf{x}_i^\top \boldsymbol{\beta} + \zeta_i</span>
<span id="cb7-64"><a href="#cb7-64" aria-hidden="true" tabindex="-1"></a>$$ {#eq-eta}</span>
<span id="cb7-65"><a href="#cb7-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-66"><a href="#cb7-66" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb7-67"><a href="#cb7-67" aria-hidden="true" tabindex="-1"></a>Y_{ik} = \lambda_k \eta_i + \varepsilon_{ik}</span>
<span id="cb7-68"><a href="#cb7-68" aria-hidden="true" tabindex="-1"></a>$$ {#eq-measure}</span>
<span id="cb7-69"><a href="#cb7-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-70"><a href="#cb7-70" aria-hidden="true" tabindex="-1"></a>where:</span>
<span id="cb7-71"><a href="#cb7-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-72"><a href="#cb7-72" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$\mathbf{x}_i$ is the vector of process variables,</span>
<span id="cb7-73"><a href="#cb7-73" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$\boldsymbol{\beta}$ are structural coefficients,</span>
<span id="cb7-74"><a href="#cb7-74" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$\lambda_k$ are measurement loadings,</span>
<span id="cb7-75"><a href="#cb7-75" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$\zeta_i \sim \mathcal{N}(0, \sigma_\zeta^2)$,</span>
<span id="cb7-76"><a href="#cb7-76" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$\varepsilon_{ik} \sim \mathcal{N}(0, \sigma_{\varepsilon_k}^2)$.</span>
<span id="cb7-77"><a href="#cb7-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-78"><a href="#cb7-78" aria-hidden="true" tabindex="-1"></a>As shown in Eq. @eq-eta and Eq. @eq-measure,</span>
<span id="cb7-79"><a href="#cb7-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-80"><a href="#cb7-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-81"><a href="#cb7-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-82"><a href="#cb7-82" aria-hidden="true" tabindex="-1"></a>Como se muestra en la Figura @fig-arquitectura, el modelo integra la red multi-eslabón con la capa Bayesiana y la capa de optimización.</span>
<span id="cb7-83"><a href="#cb7-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-84"><a href="#cb7-84" aria-hidden="true" tabindex="-1"></a>![](images/Dan(2026)v2.png){#fig-arquitectura fig-cap="Arquitectura general del modelo." width=40%}</span>
<span id="cb7-85"><a href="#cb7-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-86"><a href="#cb7-86" aria-hidden="true" tabindex="-1"></a><span class="fu"># Simulated SEM Results</span></span>
<span id="cb7-87"><a href="#cb7-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-90"><a href="#cb7-90" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb7-91"><a href="#cb7-91" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-align: center</span></span>
<span id="cb7-92"><a href="#cb7-92" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 7</span></span>
<span id="cb7-93"><a href="#cb7-93" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 4.5</span></span>
<span id="cb7-94"><a href="#cb7-94" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Distribution of simulated latent quality (η)."</span></span>
<span id="cb7-95"><a href="#cb7-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-96"><a href="#cb7-96" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb7-97"><a href="#cb7-97" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb7-98"><a href="#cb7-98" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb7-99"><a href="#cb7-99" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb7-100"><a href="#cb7-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-101"><a href="#cb7-101" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">42</span>)</span>
<span id="cb7-102"><a href="#cb7-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-103"><a href="#cb7-103" aria-hidden="true" tabindex="-1"></a>out_fig <span class="op">=</span> Path(<span class="st">"results/figures"</span>)</span>
<span id="cb7-104"><a href="#cb7-104" aria-hidden="true" tabindex="-1"></a>out_tab <span class="op">=</span> Path(<span class="st">"results/tables"</span>)</span>
<span id="cb7-105"><a href="#cb7-105" aria-hidden="true" tabindex="-1"></a>out_fig.mkdir(parents<span class="op">=</span><span class="va">True</span>, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb7-106"><a href="#cb7-106" aria-hidden="true" tabindex="-1"></a>out_tab.mkdir(parents<span class="op">=</span><span class="va">True</span>, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb7-107"><a href="#cb7-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-108"><a href="#cb7-108" aria-hidden="true" tabindex="-1"></a>n_products <span class="op">=</span> <span class="dv">200</span></span>
<span id="cb7-109"><a href="#cb7-109" aria-hidden="true" tabindex="-1"></a>n_attributes <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb7-110"><a href="#cb7-110" aria-hidden="true" tabindex="-1"></a>n_process_vars <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb7-111"><a href="#cb7-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-112"><a href="#cb7-112" aria-hidden="true" tabindex="-1"></a>beta_true <span class="op">=</span> np.random.normal(<span class="dv">0</span>, <span class="fl">0.8</span>, n_process_vars)</span>
<span id="cb7-113"><a href="#cb7-113" aria-hidden="true" tabindex="-1"></a>lambda_true <span class="op">=</span> np.array([<span class="fl">0.9</span>, <span class="fl">1.1</span>, <span class="fl">0.8</span>])</span>
<span id="cb7-114"><a href="#cb7-114" aria-hidden="true" tabindex="-1"></a>sigma_zeta_true <span class="op">=</span> <span class="fl">0.5</span></span>
<span id="cb7-115"><a href="#cb7-115" aria-hidden="true" tabindex="-1"></a>sigma_eps_true <span class="op">=</span> np.array([<span class="fl">0.4</span>, <span class="fl">0.3</span>, <span class="fl">0.5</span>])</span>
<span id="cb7-116"><a href="#cb7-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-117"><a href="#cb7-117" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> np.random.normal(<span class="dv">0</span>, <span class="dv">1</span>, (n_products, n_process_vars))</span>
<span id="cb7-118"><a href="#cb7-118" aria-hidden="true" tabindex="-1"></a>zeta <span class="op">=</span> np.random.normal(<span class="dv">0</span>, sigma_zeta_true, n_products)</span>
<span id="cb7-119"><a href="#cb7-119" aria-hidden="true" tabindex="-1"></a>eta <span class="op">=</span> X <span class="op">@</span> beta_true <span class="op">+</span> zeta</span>
<span id="cb7-120"><a href="#cb7-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-121"><a href="#cb7-121" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> np.zeros((n_products, n_attributes))</span>
<span id="cb7-122"><a href="#cb7-122" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> <span class="bu">range</span>(n_attributes):</span>
<span id="cb7-123"><a href="#cb7-123" aria-hidden="true" tabindex="-1"></a>    eps <span class="op">=</span> np.random.normal(<span class="dv">0</span>, sigma_eps_true[k], n_products)</span>
<span id="cb7-124"><a href="#cb7-124" aria-hidden="true" tabindex="-1"></a>    Y[:, k] <span class="op">=</span> lambda_true[k] <span class="op">*</span> eta <span class="op">+</span> eps</span>
<span id="cb7-125"><a href="#cb7-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-126"><a href="#cb7-126" aria-hidden="true" tabindex="-1"></a>dfY <span class="op">=</span> pd.DataFrame(Y, columns<span class="op">=</span>[<span class="st">"Durability"</span>, <span class="st">"Appearance"</span>, <span class="st">"Comfort"</span>])</span>
<span id="cb7-127"><a href="#cb7-127" aria-hidden="true" tabindex="-1"></a>corr <span class="op">=</span> dfY.corr()</span>
<span id="cb7-128"><a href="#cb7-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-129"><a href="#cb7-129" aria-hidden="true" tabindex="-1"></a>corr.to_csv(out_tab <span class="op">/</span> <span class="st">"corr_attributes.csv"</span>, index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb7-130"><a href="#cb7-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-131"><a href="#cb7-131" aria-hidden="true" tabindex="-1"></a>plt.figure()</span>
<span id="cb7-132"><a href="#cb7-132" aria-hidden="true" tabindex="-1"></a>plt.hist(eta, bins<span class="op">=</span><span class="dv">30</span>)</span>
<span id="cb7-133"><a href="#cb7-133" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Simulated latent quality η"</span>)</span>
<span id="cb7-134"><a href="#cb7-134" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb7-135"><a href="#cb7-135" aria-hidden="true" tabindex="-1"></a>plt.savefig(out_fig <span class="op">/</span> <span class="st">"eta_hist.png"</span>, dpi<span class="op">=</span><span class="dv">200</span>)</span>
<span id="cb7-136"><a href="#cb7-136" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb7-137"><a href="#cb7-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-138"><a href="#cb7-138" aria-hidden="true" tabindex="-1"></a>corr.<span class="bu">round</span>(<span class="dv">3</span>)</span>
<span id="cb7-139"><a href="#cb7-139" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-140"><a href="#cb7-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-141"><a href="#cb7-141" aria-hidden="true" tabindex="-1"></a><span class="fu"># Bayesian SEM Estimation (PyMC)</span></span>
<span id="cb7-142"><a href="#cb7-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-145"><a href="#cb7-145" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb7-146"><a href="#cb7-146" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pymc <span class="im">as</span> pm</span>
<span id="cb7-147"><a href="#cb7-147" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pytensor.tensor <span class="im">as</span> pt</span>
<span id="cb7-148"><a href="#cb7-148" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> arviz <span class="im">as</span> az</span>
<span id="cb7-149"><a href="#cb7-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-150"><a href="#cb7-150" aria-hidden="true" tabindex="-1"></a>Y_obs <span class="op">=</span> dfY.values</span>
<span id="cb7-151"><a href="#cb7-151" aria-hidden="true" tabindex="-1"></a>X_obs <span class="op">=</span> X</span>
<span id="cb7-152"><a href="#cb7-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-153"><a href="#cb7-153" aria-hidden="true" tabindex="-1"></a>n, J <span class="op">=</span> X_obs.shape</span>
<span id="cb7-154"><a href="#cb7-154" aria-hidden="true" tabindex="-1"></a>K <span class="op">=</span> Y_obs.shape[<span class="dv">1</span>]</span>
<span id="cb7-155"><a href="#cb7-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-156"><a href="#cb7-156" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> pm.Model() <span class="im">as</span> sem_model:</span>
<span id="cb7-157"><a href="#cb7-157" aria-hidden="true" tabindex="-1"></a>    beta <span class="op">=</span> pm.Normal(<span class="st">"beta"</span>, mu<span class="op">=</span><span class="fl">0.0</span>, sigma<span class="op">=</span><span class="fl">1.0</span>, shape<span class="op">=</span>J)</span>
<span id="cb7-158"><a href="#cb7-158" aria-hidden="true" tabindex="-1"></a>    sigma_zeta <span class="op">=</span> pm.HalfNormal(<span class="st">"sigma_zeta"</span>, sigma<span class="op">=</span><span class="fl">1.0</span>)</span>
<span id="cb7-159"><a href="#cb7-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-160"><a href="#cb7-160" aria-hidden="true" tabindex="-1"></a>    lam <span class="op">=</span> pm.Normal(<span class="st">"lambda"</span>, mu<span class="op">=</span><span class="fl">1.0</span>, sigma<span class="op">=</span><span class="fl">0.5</span>, shape<span class="op">=</span>K)</span>
<span id="cb7-161"><a href="#cb7-161" aria-hidden="true" tabindex="-1"></a>    sigma_eps <span class="op">=</span> pm.HalfNormal(<span class="st">"sigma_eps"</span>, sigma<span class="op">=</span><span class="fl">1.0</span>, shape<span class="op">=</span>K)</span>
<span id="cb7-162"><a href="#cb7-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-163"><a href="#cb7-163" aria-hidden="true" tabindex="-1"></a>    eta_latent <span class="op">=</span> pm.Normal(</span>
<span id="cb7-164"><a href="#cb7-164" aria-hidden="true" tabindex="-1"></a>        <span class="st">"eta"</span>,</span>
<span id="cb7-165"><a href="#cb7-165" aria-hidden="true" tabindex="-1"></a>        mu<span class="op">=</span>pt.dot(X_obs, beta),</span>
<span id="cb7-166"><a href="#cb7-166" aria-hidden="true" tabindex="-1"></a>        sigma<span class="op">=</span>sigma_zeta,</span>
<span id="cb7-167"><a href="#cb7-167" aria-hidden="true" tabindex="-1"></a>        shape<span class="op">=</span>n</span>
<span id="cb7-168"><a href="#cb7-168" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-169"><a href="#cb7-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-170"><a href="#cb7-170" aria-hidden="true" tabindex="-1"></a>    muY <span class="op">=</span> eta_latent[:, <span class="va">None</span>] <span class="op">*</span> lam[<span class="va">None</span>, :]</span>
<span id="cb7-171"><a href="#cb7-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-172"><a href="#cb7-172" aria-hidden="true" tabindex="-1"></a>    pm.Normal(<span class="st">"Y"</span>, mu<span class="op">=</span>muY, sigma<span class="op">=</span>sigma_eps, observed<span class="op">=</span>Y_obs)</span>
<span id="cb7-173"><a href="#cb7-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-174"><a href="#cb7-174" aria-hidden="true" tabindex="-1"></a>    idata <span class="op">=</span> pm.sample(</span>
<span id="cb7-175"><a href="#cb7-175" aria-hidden="true" tabindex="-1"></a>        draws<span class="op">=</span><span class="dv">800</span>,</span>
<span id="cb7-176"><a href="#cb7-176" aria-hidden="true" tabindex="-1"></a>        tune<span class="op">=</span><span class="dv">800</span>,</span>
<span id="cb7-177"><a href="#cb7-177" aria-hidden="true" tabindex="-1"></a>        chains<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb7-178"><a href="#cb7-178" aria-hidden="true" tabindex="-1"></a>        target_accept<span class="op">=</span><span class="fl">0.9</span>,</span>
<span id="cb7-179"><a href="#cb7-179" aria-hidden="true" tabindex="-1"></a>        random_seed<span class="op">=</span><span class="dv">42</span>,</span>
<span id="cb7-180"><a href="#cb7-180" aria-hidden="true" tabindex="-1"></a>        progressbar<span class="op">=</span><span class="va">False</span></span>
<span id="cb7-181"><a href="#cb7-181" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-182"><a href="#cb7-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-183"><a href="#cb7-183" aria-hidden="true" tabindex="-1"></a>az.summary(idata, var_names<span class="op">=</span>[<span class="st">"beta"</span>, <span class="st">"lambda"</span>, <span class="st">"sigma_zeta"</span>, <span class="st">"sigma_eps"</span>], round_to<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb7-184"><a href="#cb7-184" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-185"><a href="#cb7-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-186"><a href="#cb7-186" aria-hidden="true" tabindex="-1"></a><span class="fu"># Posterior Diagnostics</span></span>
<span id="cb7-187"><a href="#cb7-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-190"><a href="#cb7-190" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb7-191"><a href="#cb7-191" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-align: center</span></span>
<span id="cb7-192"><a href="#cb7-192" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 8</span></span>
<span id="cb7-193"><a href="#cb7-193" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 5</span></span>
<span id="cb7-194"><a href="#cb7-194" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "MCMC trace diagnostics."</span></span>
<span id="cb7-195"><a href="#cb7-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-196"><a href="#cb7-196" aria-hidden="true" tabindex="-1"></a>az.plot_trace(idata, var_names<span class="op">=</span>[<span class="st">"beta"</span>, <span class="st">"lambda"</span>, <span class="st">"sigma_zeta"</span>, <span class="st">"sigma_eps"</span>])</span>
<span id="cb7-197"><a href="#cb7-197" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb7-198"><a href="#cb7-198" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb7-199"><a href="#cb7-199" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-200"><a href="#cb7-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-201"><a href="#cb7-201" aria-hidden="true" tabindex="-1"></a><span class="fu"># Parameter Recovery Check</span></span>
<span id="cb7-202"><a href="#cb7-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-205"><a href="#cb7-205" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb7-206"><a href="#cb7-206" aria-hidden="true" tabindex="-1"></a>post <span class="op">=</span> az.summary(idata, var_names<span class="op">=</span>[<span class="st">"beta"</span>, <span class="st">"lambda"</span>], round_to<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb7-207"><a href="#cb7-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-208"><a href="#cb7-208" aria-hidden="true" tabindex="-1"></a>post_mean_beta <span class="op">=</span> post.loc[[<span class="ss">f"beta[</span><span class="sc">{</span>j<span class="sc">}</span><span class="ss">]"</span> <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(J)], <span class="st">"mean"</span>].to_numpy()</span>
<span id="cb7-209"><a href="#cb7-209" aria-hidden="true" tabindex="-1"></a>post_mean_lam <span class="op">=</span> post.loc[[<span class="ss">f"lambda[</span><span class="sc">{</span>k<span class="sc">}</span><span class="ss">]"</span> <span class="cf">for</span> k <span class="kw">in</span> <span class="bu">range</span>(K)], <span class="st">"mean"</span>].to_numpy()</span>
<span id="cb7-210"><a href="#cb7-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-211"><a href="#cb7-211" aria-hidden="true" tabindex="-1"></a>comparison <span class="op">=</span> pd.DataFrame({</span>
<span id="cb7-212"><a href="#cb7-212" aria-hidden="true" tabindex="-1"></a>    <span class="st">"true"</span>: np.concatenate([beta_true, lambda_true]),</span>
<span id="cb7-213"><a href="#cb7-213" aria-hidden="true" tabindex="-1"></a>    <span class="st">"posterior_mean"</span>: np.concatenate([post_mean_beta, post_mean_lam])</span>
<span id="cb7-214"><a href="#cb7-214" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb7-215"><a href="#cb7-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-216"><a href="#cb7-216" aria-hidden="true" tabindex="-1"></a>comparison</span>
<span id="cb7-217"><a href="#cb7-217" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-218"><a href="#cb7-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-221"><a href="#cb7-221" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb7-222"><a href="#cb7-222" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-align: center</span></span>
<span id="cb7-223"><a href="#cb7-223" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 7</span></span>
<span id="cb7-224"><a href="#cb7-224" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 4.5</span></span>
<span id="cb7-225"><a href="#cb7-225" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Posterior mean vs true parameter values."</span></span>
<span id="cb7-226"><a href="#cb7-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-227"><a href="#cb7-227" aria-hidden="true" tabindex="-1"></a>plt.figure()</span>
<span id="cb7-228"><a href="#cb7-228" aria-hidden="true" tabindex="-1"></a>plt.scatter(comparison[<span class="st">"true"</span>], comparison[<span class="st">"posterior_mean"</span>])</span>
<span id="cb7-229"><a href="#cb7-229" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"True value"</span>)</span>
<span id="cb7-230"><a href="#cb7-230" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Posterior mean"</span>)</span>
<span id="cb7-231"><a href="#cb7-231" aria-hidden="true" tabindex="-1"></a>plt.plot(</span>
<span id="cb7-232"><a href="#cb7-232" aria-hidden="true" tabindex="-1"></a>    [comparison[<span class="st">"true"</span>].<span class="bu">min</span>(), comparison[<span class="st">"true"</span>].<span class="bu">max</span>()],</span>
<span id="cb7-233"><a href="#cb7-233" aria-hidden="true" tabindex="-1"></a>    [comparison[<span class="st">"true"</span>].<span class="bu">min</span>(), comparison[<span class="st">"true"</span>].<span class="bu">max</span>()]</span>
<span id="cb7-234"><a href="#cb7-234" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-235"><a href="#cb7-235" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb7-236"><a href="#cb7-236" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb7-237"><a href="#cb7-237" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-238"><a href="#cb7-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-239"><a href="#cb7-239" aria-hidden="true" tabindex="-1"></a><span class="fu"># Integrated Architecture (Conceptual Diagram)</span></span>
<span id="cb7-240"><a href="#cb7-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-243"><a href="#cb7-243" aria-hidden="true" tabindex="-1"></a><span class="in">```{mermaid}</span></span>
<span id="cb7-244"><a href="#cb7-244" aria-hidden="true" tabindex="-1"></a>%<span class="dt">%</span>{init: {</span>
<span id="cb7-245"><a href="#cb7-245" aria-hidden="true" tabindex="-1"></a>  <span class="ot">"</span><span class="st">theme</span><span class="ot">"</span>: <span class="ot">"</span><span class="st">base</span><span class="ot">"</span>,</span>
<span id="cb7-246"><a href="#cb7-246" aria-hidden="true" tabindex="-1"></a>  <span class="ot">"</span><span class="st">themeVariables</span><span class="ot">"</span>: {</span>
<span id="cb7-247"><a href="#cb7-247" aria-hidden="true" tabindex="-1"></a>    <span class="ot">"</span><span class="st">background</span><span class="ot">"</span>: <span class="ot">"</span><span class="st">#ffffff</span><span class="ot">"</span>,</span>
<span id="cb7-248"><a href="#cb7-248" aria-hidden="true" tabindex="-1"></a>    <span class="ot">"</span><span class="st">primaryColor</span><span class="ot">"</span>: <span class="ot">"</span><span class="st">#ffffff</span><span class="ot">"</span>,</span>
<span id="cb7-249"><a href="#cb7-249" aria-hidden="true" tabindex="-1"></a>    <span class="ot">"</span><span class="st">primaryTextColor</span><span class="ot">"</span>: <span class="ot">"</span><span class="st">#111111</span><span class="ot">"</span>,</span>
<span id="cb7-250"><a href="#cb7-250" aria-hidden="true" tabindex="-1"></a>    <span class="ot">"</span><span class="st">primaryBorderColor</span><span class="ot">"</span>: <span class="ot">"</span><span class="st">#111111</span><span class="ot">"</span>,</span>
<span id="cb7-251"><a href="#cb7-251" aria-hidden="true" tabindex="-1"></a>    <span class="ot">"</span><span class="st">lineColor</span><span class="ot">"</span>: <span class="ot">"</span><span class="st">#111111</span><span class="ot">"</span>,</span>
<span id="cb7-252"><a href="#cb7-252" aria-hidden="true" tabindex="-1"></a>    <span class="ot">"</span><span class="st">fontSize</span><span class="ot">"</span>: <span class="ot">"</span><span class="st">12px</span><span class="ot">"</span></span>
<span id="cb7-253"><a href="#cb7-253" aria-hidden="true" tabindex="-1"></a>  },</span>
<span id="cb7-254"><a href="#cb7-254" aria-hidden="true" tabindex="-1"></a>  <span class="ot">"</span><span class="st">flowchart</span><span class="ot">"</span>: { <span class="ot">"</span><span class="st">curve</span><span class="ot">"</span>: <span class="ot">"</span><span class="st">linear</span><span class="ot">"</span> }</span>
<span id="cb7-255"><a href="#cb7-255" aria-hidden="true" tabindex="-1"></a>}}%%</span>
<span id="cb7-256"><a href="#cb7-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-257"><a href="#cb7-257" aria-hidden="true" tabindex="-1"></a>flowchart TB</span>
<span id="cb7-258"><a href="#cb7-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-259"><a href="#cb7-259" aria-hidden="true" tabindex="-1"></a>  subgraph S[<span class="ot">"</span><span class="st">Red multi-eslabón (tiers)</span><span class="ot">"</span>]</span>
<span id="cb7-260"><a href="#cb7-260" aria-hidden="true" tabindex="-1"></a>    direction TB</span>
<span id="cb7-261"><a href="#cb7-261" aria-hidden="true" tabindex="-1"></a>    T3[<span class="ot">"</span><span class="st">Tier 3</span><span class="ot">"</span>] --&gt; T2[<span class="ot">"</span><span class="st">Tier 2</span><span class="ot">"</span>] --&gt; T1[<span class="ot">"</span><span class="st">Tier 1</span><span class="ot">"</span>] --&gt; M[<span class="ot">"</span><span class="st">Manufacturer</span><span class="ot">"</span>] --&gt; D[<span class="ot">"</span><span class="st">CD</span><span class="ot">"</span>] --&gt; C[<span class="ot">"</span><span class="st">Customer</span><span class="ot">"</span>]</span>
<span id="cb7-262"><a href="#cb7-262" aria-hidden="true" tabindex="-1"></a>  end</span>
<span id="cb7-263"><a href="#cb7-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-264"><a href="#cb7-264" aria-hidden="true" tabindex="-1"></a>  subgraph B[<span class="ot">"</span><span class="st">Capa Bayesiana (SEM + BO)</span><span class="ot">"</span>]</span>
<span id="cb7-265"><a href="#cb7-265" aria-hidden="true" tabindex="-1"></a>    direction TB</span>
<span id="cb7-266"><a href="#cb7-266" aria-hidden="true" tabindex="-1"></a>    X[<span class="ot">"</span><span class="st">Procesos / variables&lt;br/&gt;X_s</span><span class="ot">"</span>] --&gt; ETA[<span class="ot">"</span><span class="st">Calidad latente η</span><span class="ot">"</span>]</span>
<span id="cb7-267"><a href="#cb7-267" aria-hidden="true" tabindex="-1"></a>    ETA --&gt; Y[<span class="ot">"</span><span class="st">Criterios Y_{c,k}</span><span class="ot">"</span>]</span>
<span id="cb7-268"><a href="#cb7-268" aria-hidden="true" tabindex="-1"></a>    Y --&gt; SC[<span class="ot">"</span><span class="st">Satisfacción S_c</span><span class="ot">"</span>]</span>
<span id="cb7-269"><a href="#cb7-269" aria-hidden="true" tabindex="-1"></a>    SC --&gt; U[<span class="ot">"</span><span class="st">Utilidad económica U</span><span class="ot">"</span>]</span>
<span id="cb7-270"><a href="#cb7-270" aria-hidden="true" tabindex="-1"></a>  end</span>
<span id="cb7-271"><a href="#cb7-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-272"><a href="#cb7-272" aria-hidden="true" tabindex="-1"></a>  S --&gt; X</span>
<span id="cb7-273"><a href="#cb7-273" aria-hidden="true" tabindex="-1"></a>  U --&gt; MILP[<span class="ot">"</span><span class="st">MILP: selección de enlaces z&lt;br/&gt;y flujos q</span><span class="ot">"</span>]</span>
<span id="cb7-274"><a href="#cb7-274" aria-hidden="true" tabindex="-1"></a>  MILP --&gt; S</span>
<span id="cb7-275"><a href="#cb7-275" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-276"><a href="#cb7-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-277"><a href="#cb7-277" aria-hidden="true" tabindex="-1"></a><span class="fu"># Customer Satisfaction and Endogenous Demand</span></span>
<span id="cb7-278"><a href="#cb7-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-279"><a href="#cb7-279" aria-hidden="true" tabindex="-1"></a>Customer satisfaction for product $p$ and customer $c$ is defined as:</span>
<span id="cb7-280"><a href="#cb7-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-281"><a href="#cb7-281" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb7-282"><a href="#cb7-282" aria-hidden="true" tabindex="-1"></a>S_{c,p} = \sum_{k=1}^{K} w_{c,k} \mathbb{E}<span class="co">[</span><span class="ot">Y_{c,p,k}</span><span class="co">]</span></span>
<span id="cb7-283"><a href="#cb7-283" aria-hidden="true" tabindex="-1"></a>$$ {#eq-satisfaction}</span>
<span id="cb7-284"><a href="#cb7-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-285"><a href="#cb7-285" aria-hidden="true" tabindex="-1"></a>where:</span>
<span id="cb7-286"><a href="#cb7-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-287"><a href="#cb7-287" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$w_{c,k}$ represents the importance weight of criterion $k$ for customer $c$,</span>
<span id="cb7-288"><a href="#cb7-288" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$\sum_{k} w_{c,k} = 1$.</span>
<span id="cb7-289"><a href="#cb7-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-290"><a href="#cb7-290" aria-hidden="true" tabindex="-1"></a>Demand is assumed to be endogenous and driven by satisfaction:</span>
<span id="cb7-291"><a href="#cb7-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-292"><a href="#cb7-292" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb7-293"><a href="#cb7-293" aria-hidden="true" tabindex="-1"></a>d_{c,p} = d_{c,p}^{0} + \alpha_{c,p} S_{c,p}</span>
<span id="cb7-294"><a href="#cb7-294" aria-hidden="true" tabindex="-1"></a>$$ {#eq-demand}</span>
<span id="cb7-295"><a href="#cb7-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-296"><a href="#cb7-296" aria-hidden="true" tabindex="-1"></a>where:</span>
<span id="cb7-297"><a href="#cb7-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-298"><a href="#cb7-298" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$d_{c,p}^{0}$ is the baseline demand,</span>
<span id="cb7-299"><a href="#cb7-299" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$\alpha_{c,p}$ measures sensitivity of demand to satisfaction.</span>
<span id="cb7-300"><a href="#cb7-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-301"><a href="#cb7-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-302"><a href="#cb7-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-303"><a href="#cb7-303" aria-hidden="true" tabindex="-1"></a><span class="fu"># Economic Utility Function</span></span>
<span id="cb7-304"><a href="#cb7-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-305"><a href="#cb7-305" aria-hidden="true" tabindex="-1"></a>Total economic utility is defined as:</span>
<span id="cb7-306"><a href="#cb7-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-307"><a href="#cb7-307" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb7-308"><a href="#cb7-308" aria-hidden="true" tabindex="-1"></a>U = \sum_{c,p} \left( price_{c,p} \cdot q_{c,p} \right)</span>
<span id="cb7-309"><a href="#cb7-309" aria-hidden="true" tabindex="-1"></a><span class="ss">+ </span>\gamma \sum_{c,p} S_{c,p} q_{c,p}</span>
<span id="cb7-310"><a href="#cb7-310" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>C</span>
<span id="cb7-311"><a href="#cb7-311" aria-hidden="true" tabindex="-1"></a>$$ {#eq-utility}</span>
<span id="cb7-312"><a href="#cb7-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-313"><a href="#cb7-313" aria-hidden="true" tabindex="-1"></a>where:</span>
<span id="cb7-314"><a href="#cb7-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-315"><a href="#cb7-315" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$q_{c,p}$ is the quantity delivered to customer $c$,</span>
<span id="cb7-316"><a href="#cb7-316" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$\gamma$ represents the economic impact of satisfaction,</span>
<span id="cb7-317"><a href="#cb7-317" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$C$ is total supply chain cost.</span>
<span id="cb7-318"><a href="#cb7-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-319"><a href="#cb7-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-320"><a href="#cb7-320" aria-hidden="true" tabindex="-1"></a><span class="fu"># Cost Structure</span></span>
<span id="cb7-321"><a href="#cb7-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-322"><a href="#cb7-322" aria-hidden="true" tabindex="-1"></a>Total cost is composed of:</span>
<span id="cb7-323"><a href="#cb7-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-324"><a href="#cb7-324" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb7-325"><a href="#cb7-325" aria-hidden="true" tabindex="-1"></a>C = C^{var} + C^{struct}</span>
<span id="cb7-326"><a href="#cb7-326" aria-hidden="true" tabindex="-1"></a>$$ {#eq-cost-total}</span>
<span id="cb7-327"><a href="#cb7-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-328"><a href="#cb7-328" aria-hidden="true" tabindex="-1"></a>Variable cost:</span>
<span id="cb7-329"><a href="#cb7-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-330"><a href="#cb7-330" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb7-331"><a href="#cb7-331" aria-hidden="true" tabindex="-1"></a>C^{var} = \sum_{(i,j),p} c^{arc}_{i,j,p} q_{i,j,p}</span>
<span id="cb7-332"><a href="#cb7-332" aria-hidden="true" tabindex="-1"></a>$$ {#eq-cost-var}</span>
<span id="cb7-333"><a href="#cb7-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-334"><a href="#cb7-334" aria-hidden="true" tabindex="-1"></a>Structural cost:</span>
<span id="cb7-335"><a href="#cb7-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-336"><a href="#cb7-336" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb7-337"><a href="#cb7-337" aria-hidden="true" tabindex="-1"></a>C^{struct} = \sum_{(i,j),p} f_{i,j} z_{i,j,p}</span>
<span id="cb7-338"><a href="#cb7-338" aria-hidden="true" tabindex="-1"></a>$$ {#eq-cost-struct}</span>
<span id="cb7-339"><a href="#cb7-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-340"><a href="#cb7-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-341"><a href="#cb7-341" aria-hidden="true" tabindex="-1"></a><span class="fu"># MILP Formulation</span></span>
<span id="cb7-342"><a href="#cb7-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-343"><a href="#cb7-343" aria-hidden="true" tabindex="-1"></a>The optimization problem is:</span>
<span id="cb7-344"><a href="#cb7-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-345"><a href="#cb7-345" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb7-346"><a href="#cb7-346" aria-hidden="true" tabindex="-1"></a>\max U</span>
<span id="cb7-347"><a href="#cb7-347" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb7-348"><a href="#cb7-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-349"><a href="#cb7-349" aria-hidden="true" tabindex="-1"></a>Subject to:</span>
<span id="cb7-350"><a href="#cb7-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-351"><a href="#cb7-351" aria-hidden="true" tabindex="-1"></a>Flow conservation:</span>
<span id="cb7-352"><a href="#cb7-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-353"><a href="#cb7-353" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb7-354"><a href="#cb7-354" aria-hidden="true" tabindex="-1"></a>\sum_{i} q_{i,j,p} = \sum_{k} q_{j,k,p}</span>
<span id="cb7-355"><a href="#cb7-355" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb7-356"><a href="#cb7-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-357"><a href="#cb7-357" aria-hidden="true" tabindex="-1"></a>Capacity constraints:</span>
<span id="cb7-358"><a href="#cb7-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-359"><a href="#cb7-359" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb7-360"><a href="#cb7-360" aria-hidden="true" tabindex="-1"></a>\sum_{j,p} q_{i,j,p} \leq Cap_i</span>
<span id="cb7-361"><a href="#cb7-361" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb7-362"><a href="#cb7-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-363"><a href="#cb7-363" aria-hidden="true" tabindex="-1"></a>Link activation constraints:</span>
<span id="cb7-364"><a href="#cb7-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-365"><a href="#cb7-365" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb7-366"><a href="#cb7-366" aria-hidden="true" tabindex="-1"></a>q_{i,j,p} \leq M z_{i,j,p}</span>
<span id="cb7-367"><a href="#cb7-367" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb7-368"><a href="#cb7-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-369"><a href="#cb7-369" aria-hidden="true" tabindex="-1"></a>Binary structure:</span>
<span id="cb7-370"><a href="#cb7-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-371"><a href="#cb7-371" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb7-372"><a href="#cb7-372" aria-hidden="true" tabindex="-1"></a>z_{i,j,p} \in <span class="sc">\{</span>0,1<span class="sc">\}</span></span>
<span id="cb7-373"><a href="#cb7-373" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb7-374"><a href="#cb7-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-375"><a href="#cb7-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-376"><a href="#cb7-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-377"><a href="#cb7-377" aria-hidden="true" tabindex="-1"></a><span class="fu"># Bayesian Optimization Layer (GP + Expected Improvement)</span></span>
<span id="cb7-378"><a href="#cb7-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-379"><a href="#cb7-379" aria-hidden="true" tabindex="-1"></a>This section formalizes the Bayesian Optimization (BO) layer used to learn or adapt decision parameters (e.g., customer weights, process targets, or policy parameters) that affect satisfaction and the downstream MILP objective. Let $\boldsymbol{\theta}\in\Theta\subset\mathbb{R}^d$ denote the vector of tunable parameters. Examples include:</span>
<span id="cb7-380"><a href="#cb7-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-381"><a href="#cb7-381" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>preference weights $\boldsymbol{\theta}=<span class="sc">\{</span>w_{c,k}<span class="sc">\}</span>$,</span>
<span id="cb7-382"><a href="#cb7-382" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>process-control targets $\boldsymbol{\theta}=<span class="sc">\{</span>x_{s,j}^{\star}<span class="sc">\}</span>$,</span>
<span id="cb7-383"><a href="#cb7-383" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>economic trade-off parameters $\boldsymbol{\theta}=<span class="sc">\{</span>\gamma,\alpha_{c,p}<span class="sc">\}</span>$,</span>
<span id="cb7-384"><a href="#cb7-384" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>or any calibration vector that impacts expected satisfaction and utility.</span>
<span id="cb7-385"><a href="#cb7-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-386"><a href="#cb7-386" aria-hidden="true" tabindex="-1"></a>We define the (black-box) BO objective as the **expected economic utility** induced by $\boldsymbol{\theta}$:</span>
<span id="cb7-387"><a href="#cb7-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-388"><a href="#cb7-388" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb7-389"><a href="#cb7-389" aria-hidden="true" tabindex="-1"></a>f(\boldsymbol{\theta}) \;=\; \mathbb{E}\Big<span class="co">[</span><span class="ot">\, U(\boldsymbol{q}^{\star}(\boldsymbol{\theta}),\boldsymbol{z}^{\star}(\boldsymbol{\theta});\,\boldsymbol{\theta}) \,\Big</span><span class="co">]</span>,</span>
<span id="cb7-390"><a href="#cb7-390" aria-hidden="true" tabindex="-1"></a>$$ {#eq-bo-obj}</span>
<span id="cb7-391"><a href="#cb7-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-392"><a href="#cb7-392" aria-hidden="true" tabindex="-1"></a>where $(\boldsymbol{q}^{\star}(\boldsymbol{\theta}),\boldsymbol{z}^{\star}(\boldsymbol{\theta}))$ is the MILP optimal solution under parameterization $\boldsymbol{\theta}$, and the expectation is taken with respect to the Bayesian layer uncertainty (SEM posterior and any stochastic components).</span>
<span id="cb7-393"><a href="#cb7-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-394"><a href="#cb7-394" aria-hidden="true" tabindex="-1"></a><span class="fu">## Gaussian Process Surrogate</span></span>
<span id="cb7-395"><a href="#cb7-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-396"><a href="#cb7-396" aria-hidden="true" tabindex="-1"></a>At iteration $n$, we have evaluated $f$ at $\mathcal{D}_n=\{(\boldsymbol{\theta}_i, y_i)\}_{i=1}^n$, where:</span>
<span id="cb7-397"><a href="#cb7-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-398"><a href="#cb7-398" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb7-399"><a href="#cb7-399" aria-hidden="true" tabindex="-1"></a>y_i \;=\; f(\boldsymbol{\theta}_i) + \epsilon_i,\qquad \epsilon_i \sim \mathcal{N}(0,\sigma_\epsilon^2).</span>
<span id="cb7-400"><a href="#cb7-400" aria-hidden="true" tabindex="-1"></a>$$ {#eq-bo-noise}</span>
<span id="cb7-401"><a href="#cb7-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-402"><a href="#cb7-402" aria-hidden="true" tabindex="-1"></a>We place a Gaussian Process prior on $f$:</span>
<span id="cb7-403"><a href="#cb7-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-404"><a href="#cb7-404" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb7-405"><a href="#cb7-405" aria-hidden="true" tabindex="-1"></a>f(\boldsymbol{\theta}) \sim \mathcal{GP}\big(m(\boldsymbol{\theta}),\,k(\boldsymbol{\theta},\boldsymbol{\theta}')\big),</span>
<span id="cb7-406"><a href="#cb7-406" aria-hidden="true" tabindex="-1"></a>$$ {#eq-gp-prior}</span>
<span id="cb7-407"><a href="#cb7-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-408"><a href="#cb7-408" aria-hidden="true" tabindex="-1"></a>commonly using a constant mean $m(\boldsymbol{\theta})=m_0$ and an RBF kernel:</span>
<span id="cb7-409"><a href="#cb7-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-410"><a href="#cb7-410" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb7-411"><a href="#cb7-411" aria-hidden="true" tabindex="-1"></a>k(\boldsymbol{\theta},\boldsymbol{\theta}') \;=\; \sigma_f^2 \exp<span class="sc">\!</span>\left(</span>
<span id="cb7-412"><a href="#cb7-412" aria-hidden="true" tabindex="-1"></a>-\frac{1}{2}\sum_{\ell=1}^{d}\frac{(\theta_\ell-\theta'_\ell)^2}{\rho_\ell^2}</span>
<span id="cb7-413"><a href="#cb7-413" aria-hidden="true" tabindex="-1"></a>\right).</span>
<span id="cb7-414"><a href="#cb7-414" aria-hidden="true" tabindex="-1"></a>$$ {#eq-gp-kernel}</span>
<span id="cb7-415"><a href="#cb7-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-416"><a href="#cb7-416" aria-hidden="true" tabindex="-1"></a>Given $\mathcal{D}_n$, the GP posterior at a candidate $\boldsymbol{\theta}$ is Gaussian:</span>
<span id="cb7-417"><a href="#cb7-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-418"><a href="#cb7-418" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb7-419"><a href="#cb7-419" aria-hidden="true" tabindex="-1"></a>f(\boldsymbol{\theta}) \mid \mathcal{D}_n \;\sim\; \mathcal{N}<span class="sc">\!</span>\big(\mu_n(\boldsymbol{\theta}),\,\sigma_n^2(\boldsymbol{\theta})\big),</span>
<span id="cb7-420"><a href="#cb7-420" aria-hidden="true" tabindex="-1"></a>$$ {#eq-gp-post}</span>
<span id="cb7-421"><a href="#cb7-421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-422"><a href="#cb7-422" aria-hidden="true" tabindex="-1"></a>with standard expressions:</span>
<span id="cb7-423"><a href="#cb7-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-424"><a href="#cb7-424" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb7-425"><a href="#cb7-425" aria-hidden="true" tabindex="-1"></a>\mu_n(\boldsymbol{\theta}) \;=\; m(\boldsymbol{\theta}) + \mathbf{k}_n(\boldsymbol{\theta})^\top</span>
<span id="cb7-426"><a href="#cb7-426" aria-hidden="true" tabindex="-1"></a>\big(\mathbf{K}_n+\sigma_\epsilon^2\mathbf{I}\big)^{-1}\big(\mathbf{y}-\mathbf{m}_n\big),</span>
<span id="cb7-427"><a href="#cb7-427" aria-hidden="true" tabindex="-1"></a>$$ {#eq-gp-mu}</span>
<span id="cb7-428"><a href="#cb7-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-429"><a href="#cb7-429" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb7-430"><a href="#cb7-430" aria-hidden="true" tabindex="-1"></a>\sigma_n^2(\boldsymbol{\theta}) \;=\; k(\boldsymbol{\theta},\boldsymbol{\theta}) -</span>
<span id="cb7-431"><a href="#cb7-431" aria-hidden="true" tabindex="-1"></a>\mathbf{k}_n(\boldsymbol{\theta})^\top\big(\mathbf{K}_n+\sigma_\epsilon^2\mathbf{I}\big)^{-1}\mathbf{k}_n(\boldsymbol{\theta}),</span>
<span id="cb7-432"><a href="#cb7-432" aria-hidden="true" tabindex="-1"></a>$$ {#eq-gp-sigma}</span>
<span id="cb7-433"><a href="#cb7-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-434"><a href="#cb7-434" aria-hidden="true" tabindex="-1"></a>where $\mathbf{K}_n=[k(\boldsymbol{\theta}_i,\boldsymbol{\theta}_j)]_{i,j}$, $\mathbf{k}_n(\boldsymbol{\theta})=<span class="co">[</span><span class="ot">k(\boldsymbol{\theta}_1,\boldsymbol{\theta}),\ldots,k(\boldsymbol{\theta}_n,\boldsymbol{\theta})</span><span class="co">]</span>^\top$, $\mathbf{y}=<span class="co">[</span><span class="ot">y_1,\ldots,y_n</span><span class="co">]</span>^\top$, and $\mathbf{m}_n=<span class="co">[</span><span class="ot">m(\boldsymbol{\theta}_1),\ldots,m(\boldsymbol{\theta}_n)</span><span class="co">]</span>^\top$.</span>
<span id="cb7-435"><a href="#cb7-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-436"><a href="#cb7-436" aria-hidden="true" tabindex="-1"></a><span class="fu">## Expected Improvement Acquisition</span></span>
<span id="cb7-437"><a href="#cb7-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-438"><a href="#cb7-438" aria-hidden="true" tabindex="-1"></a>Let $f_n^{\max}=\max_{i\le n} y_i$ be the best observed value so far. The Expected Improvement (EI) acquisition for maximization is:</span>
<span id="cb7-439"><a href="#cb7-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-440"><a href="#cb7-440" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb7-441"><a href="#cb7-441" aria-hidden="true" tabindex="-1"></a>\mathrm{EI}_n(\boldsymbol{\theta}) \;=\;</span>
<span id="cb7-442"><a href="#cb7-442" aria-hidden="true" tabindex="-1"></a>\mathbb{E}\Big<span class="co">[</span><span class="ot">\max\big(0,\, f(\boldsymbol{\theta})-f_n^{\max}-\xi\big)\;\big|\;\mathcal{D}_n\Big</span><span class="co">]</span>,</span>
<span id="cb7-443"><a href="#cb7-443" aria-hidden="true" tabindex="-1"></a>$$ {#eq-ei-def}</span>
<span id="cb7-444"><a href="#cb7-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-445"><a href="#cb7-445" aria-hidden="true" tabindex="-1"></a>where $\xi\ge 0$ controls exploration. Under the GP posterior \@eq-gp-post, EI has closed form. Define:</span>
<span id="cb7-446"><a href="#cb7-446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-447"><a href="#cb7-447" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb7-448"><a href="#cb7-448" aria-hidden="true" tabindex="-1"></a>Z(\boldsymbol{\theta}) \;=\; \frac{\mu_n(\boldsymbol{\theta})-f_n^{\max}-\xi}{\sigma_n(\boldsymbol{\theta})},</span>
<span id="cb7-449"><a href="#cb7-449" aria-hidden="true" tabindex="-1"></a>$$ {#eq-ei-z}</span>
<span id="cb7-450"><a href="#cb7-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-451"><a href="#cb7-451" aria-hidden="true" tabindex="-1"></a>then:</span>
<span id="cb7-452"><a href="#cb7-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-453"><a href="#cb7-453" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb7-454"><a href="#cb7-454" aria-hidden="true" tabindex="-1"></a>\mathrm{EI}_n(\boldsymbol{\theta}) \;=\;</span>
<span id="cb7-455"><a href="#cb7-455" aria-hidden="true" tabindex="-1"></a>\big(\mu_n(\boldsymbol{\theta})-f_n^{\max}-\xi\big)\Phi<span class="sc">\!</span>\big(Z(\boldsymbol{\theta})\big)</span>
<span id="cb7-456"><a href="#cb7-456" aria-hidden="true" tabindex="-1"></a>+\sigma_n(\boldsymbol{\theta})\phi<span class="sc">\!</span>\big(Z(\boldsymbol{\theta})\big),</span>
<span id="cb7-457"><a href="#cb7-457" aria-hidden="true" tabindex="-1"></a>$$ {#eq-ei-closed}</span>
<span id="cb7-458"><a href="#cb7-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-459"><a href="#cb7-459" aria-hidden="true" tabindex="-1"></a>with $\Phi(\cdot)$ and $\phi(\cdot)$ the standard normal CDF and PDF.</span>
<span id="cb7-460"><a href="#cb7-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-461"><a href="#cb7-461" aria-hidden="true" tabindex="-1"></a>The BO iteration selects the next evaluation point by:</span>
<span id="cb7-462"><a href="#cb7-462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-463"><a href="#cb7-463" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb7-464"><a href="#cb7-464" aria-hidden="true" tabindex="-1"></a>\boldsymbol{\theta}_{n+1} \;=\; \arg\max_{\boldsymbol{\theta}\in\Theta}\;\mathrm{EI}_n(\boldsymbol{\theta}).</span>
<span id="cb7-465"><a href="#cb7-465" aria-hidden="true" tabindex="-1"></a>$$ {#eq-bo-next}</span>
<span id="cb7-466"><a href="#cb7-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-467"><a href="#cb7-467" aria-hidden="true" tabindex="-1"></a><span class="fu">## Coupling with the Bayesian SEM and MILP</span></span>
<span id="cb7-468"><a href="#cb7-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-469"><a href="#cb7-469" aria-hidden="true" tabindex="-1"></a>For each candidate $\boldsymbol{\theta}$ evaluated during BO, the workflow is:</span>
<span id="cb7-470"><a href="#cb7-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-471"><a href="#cb7-471" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**SEM posterior propagation:** draw $(\boldsymbol{\beta},\boldsymbol{\lambda},\boldsymbol{\sigma}) \sim p(\cdot\mid \text{data})$ and compute $\mathbb{E}<span class="co">[</span><span class="ot">Y_{c,p,k}\mid X,\boldsymbol{\theta}</span><span class="co">]</span>$ (or Monte Carlo estimates).</span>
<span id="cb7-472"><a href="#cb7-472" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Satisfaction / demand update:** compute $S_{c,p}(\boldsymbol{\theta})$ and any derived demand parameters.</span>
<span id="cb7-473"><a href="#cb7-473" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**MILP solve:** solve the MILP to obtain $(\boldsymbol{q}^{\star}(\boldsymbol{\theta}),\boldsymbol{z}^{\star}(\boldsymbol{\theta}))$.</span>
<span id="cb7-474"><a href="#cb7-474" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>**Utility evaluation:** compute $y=f(\boldsymbol{\theta})$ as the expected (or Monte Carlo averaged) utility.</span>
<span id="cb7-475"><a href="#cb7-475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-476"><a href="#cb7-476" aria-hidden="true" tabindex="-1"></a>This closes the Bayesian loop: BO learns $\boldsymbol{\theta}$ that maximizes the satisfaction-driven expected utility under uncertainty.</span>
<span id="cb7-477"><a href="#cb7-477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-478"><a href="#cb7-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-479"><a href="#cb7-479" aria-hidden="true" tabindex="-1"></a><span class="fu"># Conclusion</span></span>
<span id="cb7-480"><a href="#cb7-480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-481"><a href="#cb7-481" aria-hidden="true" tabindex="-1"></a>The proposed framework integrates:</span>
<span id="cb7-482"><a href="#cb7-482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-483"><a href="#cb7-483" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Bayesian Structural Equation Modeling</span>
<span id="cb7-484"><a href="#cb7-484" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Multi-tier supply chain structure</span>
<span id="cb7-485"><a href="#cb7-485" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Endogenous satisfaction-driven demand</span>
<span id="cb7-486"><a href="#cb7-486" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Mixed-integer network optimization</span>
<span id="cb7-487"><a href="#cb7-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-488"><a href="#cb7-488" aria-hidden="true" tabindex="-1"></a>forming a unified architecture for economic utility maximization.</span>
<span id="cb7-489"><a href="#cb7-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-490"><a href="#cb7-490" aria-hidden="true" tabindex="-1"></a>::contentReference<span class="co">[</span><span class="ot">oaicite:0</span><span class="co">]</span>{index=0}</span>
</code></pre></div><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>